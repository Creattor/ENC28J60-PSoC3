C51 COMPILER V9.03   UDP                                                                   07/02/2012 19:47:00 PAGE 1   


C51 COMPILER V9.03, COMPILATION OF MODULE UDP
OBJECT MODULE PLACED IN .\DP8051_Keil_903\Debug\UDP.obj
COMPILER INVOKED BY: C:\Program Files (x86)\Cypress\PSoC Creator\2.1\PSoC Creator\import\keil\pk51\9.03\C51\BIN\c51.exe 
                    -.\UDP.c NOIV LARGE MODDP2 OMF2 VB(1) PR(.\DP8051_Keil_903\Debug\UDP.lst) CD DB NOIP OT(0,SIZE) INCDIR(Generated_Source\P
                    -SoC3) OJ(.\DP8051_Keil_903\Debug\UDP.obj)

line level    source

   1          /*
   2           Network Stack for PSoC3-ENC28J60 hardware
   3           -----------------------------------------
   4           Title  : UDP Transceiver functions.
   5           Author : Kartik Mankad
   6           Date : 30-06-12
   7           This code is licensed as CC-BY-SA 3.0
   8           Description : Functions to send and receive generic UDP packets.
   9           
  10          */
  11          #include "IPStackMain.h"
  12          
  13          /*******************************************************************************
  14          * Function Name: UDPReply
  15          ********************************************************************************
  16          * Summary:
  17          *   Generate and send a reply to a UDP packet RX'd.
  18          *
  19          * Parameters:
  20          *   udppkt - pointer to the UDP packet recd.
  21          *   datapayload - data to be sent in the UDP Reply.
  22          *   payloadlen - length of the data payload to be sent.
  23          *              
  24          * Returns:
  25          *   TRUE(0)- if the UDP Reply was successfully sent.
  26          *   FALSE(1) - if the UDP Reply was not successful in transmission.
  27          *******************************************************************************/
  28          unsigned int UDPReply(UDPPacket* udppkt,unsigned char* datapayload,unsigned int payloadlen){
  29   1          
  30   1          uint16 port;
  31   1          
  32   1          /*Swap the MAC Addresses in the ETH header*/
  33   1          memcpy( udppkt->udp.ip.eth.DestAddrs, udppkt->udp.ip.eth.SrcAddrs, 6);
  34   1          memcpy( udppkt->udp.ip.eth.SrcAddrs, deviceMAC,6 );
  35   1          
  36   1          /*Swap the IP Addresses in the IP header*/
  37   1          memcpy( udppkt->udp.ip.dest, udppkt->udp.ip.source,4);
  38   1          memcpy( udppkt->udp.ip.source, deviceIP,4);
  39   1          
  40   1          /*Swap the ports*/
  41   1          port=udppkt->udp.sourcePort;
  42   1          udppkt->udp.sourcePort=udppkt->udp.destPort;
  43   1          udppkt->udp.destPort=port;
  44   1          
  45   1          /*zero the checksums*/
  46   1          udppkt->udp.chksum=0x00;
  47   1          udppkt->udp.ip.chksum=0x00;
  48   1          
  49   1          /*write in the correct lengths*/
  50   1          udppkt->udp.len=(sizeof(UDPhdr)-sizeof(IPhdr))+payloadlen;
  51   1          udppkt->udp.ip.len=(sizeof(UDPhdr)+payloadlen)-sizeof(EtherNetII);
  52   1          
  53   1          /*clear the old payload*/
C51 COMPILER V9.03   UDP                                                                   07/02/2012 19:47:00 PAGE 2   

  54   1          memset(udppkt->Payload,0x00, (udppkt->udp.len)-8 );
  55   1          
  56   1          /*copy in the payload*/
  57   1          memcpy(udppkt->Payload,datapayload,payloadlen);
  58   1          
  59   1          /*do the checksums.*/
  60   1          udppkt->udp.ip.chksum=checksum(((unsigned char*) udppkt) + sizeof(EtherNetII),sizeof(IPhdr) - sizeof(E
             -therNetII),0);
  61   1          udppkt->udp.chksum=checksum((unsigned char*)udppkt->udp.ip.source,16+payloadlen,1);
  62   1          
  63   1          /*Send the packet.*/
  64   1          return(MACWrite((unsigned char*)udppkt, sizeof(UDPhdr)+payloadlen));
  65   1      }
  66          
  67          /*******************************************************************************
  68          * Function Name: UDPSend
  69          ********************************************************************************
  70          * Summary:
  71          *   Generate and send a UDP packet with data.
  72          *   You may edit the UDP Port number(that will be used as the source port) 
  73          *   in "globals.c".Default is 1200.
  74          *
  75          * Parameters:
  76          *   targetIP - IP address to send the UDP packet to.
  77          *   targetPort - Port to direct the UDP packet to.
  78          *   datapayload - data to be sent in the UDP packet.
  79          *   payloadlen - length of the data payload to be sent.
  80          *              
  81          * Returns:
  82          *   TRUE(0)- if the UDP packet was successfully sent.
  83          *   FALSE(1) - if the UDP packet was not successful in transmission.
  84          *******************************************************************************/
  85          unsigned int UDPSend(unsigned char* targetIP,unsigned int targetPort,unsigned char* datapayload,unsigned i
             -nt payloadlen){
  86   1          UDPPacket udppkt;
  87   1          
  88   1          /*Setup the IP part*/
  89   1          SetupBasicIPPacket( (unsigned char*)&udppkt, UDPPROTOCOL, targetIP );
  90   1          udppkt.udp.ip.flags = 0x0;
  91   1          
  92   1          /*Setup the ports*/
  93   1          udppkt.udp.sourcePort=UDPPort;
  94   1          udppkt.udp.destPort=targetPort;
  95   1          
  96   1          /*Zero the checksums*/
  97   1          udppkt.udp.chksum=0x00;
  98   1          udppkt.udp.ip.chksum=0x00;
  99   1          
 100   1          /*Write in the correct lengths*/
 101   1          udppkt.udp.len=(sizeof(UDPhdr)-sizeof(IPhdr))+payloadlen;
 102   1          udppkt.udp.ip.len=(sizeof(UDPhdr)+payloadlen)-sizeof(EtherNetII);
 103   1          
 104   1          /*Copy in the payload*/
 105   1          memcpy(udppkt.Payload,datapayload,payloadlen);
 106   1          
 107   1          /*Do the checksums.*/
 108   1          udppkt.udp.ip.chksum=checksum((unsigned char*)&udppkt + sizeof(EtherNetII),sizeof(IPhdr) - sizeof(Ethe
             -rNetII),0);
 109   1          udppkt.udp.chksum=checksum((unsigned char*)&udppkt.udp.ip.source,16+payloadlen,1);
 110   1          
 111   1          /*Send the packet!*/
 112   1          return(MACWrite((unsigned char*)&udppkt, sizeof(UDPhdr)+payloadlen));
C51 COMPILER V9.03   UDP                                                                   07/02/2012 19:47:00 PAGE 3   

 113   1      }
 114          
 115          /* [] END OF FILE */
C51 COMPILER V9.03   UDP                                                                   07/02/2012 19:47:00 PAGE 4   

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION _UDPReply (BEGIN)
                                           ; SOURCE LINE # 28
0000 900000      R     MOV     DPTR,#udppkt
0003 120000      E     LCALL   ?C?PSTXDATA
                                           ; SOURCE LINE # 33
0006 900000      R     MOV     DPTR,#udppkt
0009 120000      E     LCALL   ?C?PLDXDATA
000C E9                MOV     A,R1
000D 2406              ADD     A,#06H
000F F9                MOV     R1,A
0010 EA                MOV     A,R2
0011 3400              ADDC    A,#00H
0013 FA                MOV     R2,A
0014 C003              PUSH    AR3
0016 C002              PUSH    AR2
0018 C001              PUSH    AR1
001A 900000      R     MOV     DPTR,#udppkt
001D 120000      E     LCALL   ?C?PLDXDATA
0020 A801              MOV     R0,AR1
0022 AC02              MOV     R4,AR2
0024 AD03              MOV     R5,AR3
0026 D001              POP     AR1
0028 D002              POP     AR2
002A D003              POP     AR3
002C 7E00              MOV     R6,#00H
002E 7F06              MOV     R7,#06H
0030 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 34
0033 7B01              MOV     R3,#01H
0035 7A00        E     MOV     R2,#HIGH deviceMAC
0037 7900        E     MOV     R1,#LOW deviceMAC
0039 C003              PUSH    AR3
003B C002              PUSH    AR2
003D C001              PUSH    AR1
003F 900000      R     MOV     DPTR,#udppkt
0042 120000      E     LCALL   ?C?PLDXDATA
0045 E9                MOV     A,R1
0046 2406              ADD     A,#06H
0048 F9                MOV     R1,A
0049 EA                MOV     A,R2
004A 3400              ADDC    A,#00H
004C FA                MOV     R2,A
004D A801              MOV     R0,AR1
004F AC02              MOV     R4,AR2
0051 AD03              MOV     R5,AR3
0053 D001              POP     AR1
0055 D002              POP     AR2
0057 D003              POP     AR3
0059 7E00              MOV     R6,#00H
005B 7F06              MOV     R7,#06H
005D 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 37
0060 900000      R     MOV     DPTR,#udppkt
0063 120000      E     LCALL   ?C?PLDXDATA
0066 E9                MOV     A,R1
0067 241A              ADD     A,#01AH
0069 F9                MOV     R1,A
006A EA                MOV     A,R2
006B 3400              ADDC    A,#00H
C51 COMPILER V9.03   UDP                                                                   07/02/2012 19:47:00 PAGE 5   

006D FA                MOV     R2,A
006E C003              PUSH    AR3
0070 C002              PUSH    AR2
0072 C001              PUSH    AR1
0074 900000      R     MOV     DPTR,#udppkt
0077 120000      E     LCALL   ?C?PLDXDATA
007A E9                MOV     A,R1
007B 241E              ADD     A,#01EH
007D F9                MOV     R1,A
007E EA                MOV     A,R2
007F 3400              ADDC    A,#00H
0081 FA                MOV     R2,A
0082 A801              MOV     R0,AR1
0084 AC02              MOV     R4,AR2
0086 AD03              MOV     R5,AR3
0088 D001              POP     AR1
008A D002              POP     AR2
008C D003              POP     AR3
008E 7E00              MOV     R6,#00H
0090 7F04              MOV     R7,#04H
0092 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 38
0095 7B01              MOV     R3,#01H
0097 7A00        E     MOV     R2,#HIGH deviceIP
0099 7900        E     MOV     R1,#LOW deviceIP
009B C003              PUSH    AR3
009D C002              PUSH    AR2
009F C001              PUSH    AR1
00A1 900000      R     MOV     DPTR,#udppkt
00A4 120000      E     LCALL   ?C?PLDXDATA
00A7 E9                MOV     A,R1
00A8 241A              ADD     A,#01AH
00AA F9                MOV     R1,A
00AB EA                MOV     A,R2
00AC 3400              ADDC    A,#00H
00AE FA                MOV     R2,A
00AF A801              MOV     R0,AR1
00B1 AC02              MOV     R4,AR2
00B3 AD03              MOV     R5,AR3
00B5 D001              POP     AR1
00B7 D002              POP     AR2
00B9 D003              POP     AR3
00BB 7E00              MOV     R6,#00H
00BD 7F04              MOV     R7,#04H
00BF 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 41
00C2 900000      R     MOV     DPTR,#udppkt
00C5 120000      E     LCALL   ?C?PLDXDATA
00C8 E9                MOV     A,R1
00C9 2422              ADD     A,#022H
00CB F9                MOV     R1,A
00CC EA                MOV     A,R2
00CD 3400              ADDC    A,#00H
00CF FA                MOV     R2,A
00D0 120000      E     LCALL   ?C?ILDPTR
00D3 FF                MOV     R7,A
00D4 AEF0              MOV     R6,B
00D6 900000      R     MOV     DPTR,#port
00D9 EE                MOV     A,R6
00DA F0                MOVX    @DPTR,A
00DB A3                INC     DPTR
00DC EF                MOV     A,R7
C51 COMPILER V9.03   UDP                                                                   07/02/2012 19:47:00 PAGE 6   

00DD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 42
00DE 900000      R     MOV     DPTR,#udppkt
00E1 120000      E     LCALL   ?C?PLDXDATA
00E4 E9                MOV     A,R1
00E5 2424              ADD     A,#024H
00E7 F9                MOV     R1,A
00E8 EA                MOV     A,R2
00E9 3400              ADDC    A,#00H
00EB FA                MOV     R2,A
00EC 120000      E     LCALL   ?C?ILDPTR
00EF FF                MOV     R7,A
00F0 AEF0              MOV     R6,B
00F2 900000      R     MOV     DPTR,#udppkt
00F5 120000      E     LCALL   ?C?PLDXDATA
00F8 E9                MOV     A,R1
00F9 2422              ADD     A,#022H
00FB F9                MOV     R1,A
00FC EA                MOV     A,R2
00FD 3400              ADDC    A,#00H
00FF FA                MOV     R2,A
0100 EE                MOV     A,R6
0101 8FF0              MOV     B,R7
0103 120000      E     LCALL   ?C?ISTPTR
                                           ; SOURCE LINE # 43
0106 900000      R     MOV     DPTR,#port
0109 E0                MOVX    A,@DPTR
010A FE                MOV     R6,A
010B A3                INC     DPTR
010C E0                MOVX    A,@DPTR
010D FF                MOV     R7,A
010E 900000      R     MOV     DPTR,#udppkt
0111 120000      E     LCALL   ?C?PLDXDATA
0114 E9                MOV     A,R1
0115 2424              ADD     A,#024H
0117 F9                MOV     R1,A
0118 EA                MOV     A,R2
0119 3400              ADDC    A,#00H
011B FA                MOV     R2,A
011C EE                MOV     A,R6
011D 8FF0              MOV     B,R7
011F 120000      E     LCALL   ?C?ISTPTR
                                           ; SOURCE LINE # 46
0122 900000      R     MOV     DPTR,#udppkt
0125 120000      E     LCALL   ?C?PLDXDATA
0128 E9                MOV     A,R1
0129 2428              ADD     A,#028H
012B F9                MOV     R1,A
012C EA                MOV     A,R2
012D 3400              ADDC    A,#00H
012F FA                MOV     R2,A
0130 E4                CLR     A
0131 75F000            MOV     B,#00H
0134 120000      E     LCALL   ?C?ISTPTR
                                           ; SOURCE LINE # 47
0137 900000      R     MOV     DPTR,#udppkt
013A 120000      E     LCALL   ?C?PLDXDATA
013D E9                MOV     A,R1
013E 2418              ADD     A,#018H
0140 F9                MOV     R1,A
0141 EA                MOV     A,R2
0142 3400              ADDC    A,#00H
C51 COMPILER V9.03   UDP                                                                   07/02/2012 19:47:00 PAGE 7   

0144 FA                MOV     R2,A
0145 E4                CLR     A
0146 75F000            MOV     B,#00H
0149 120000      E     LCALL   ?C?ISTPTR
                                           ; SOURCE LINE # 50
014C 900000      R     MOV     DPTR,#payloadlen
014F E0                MOVX    A,@DPTR
0150 FE                MOV     R6,A
0151 A3                INC     DPTR
0152 E0                MOVX    A,@DPTR
0153 FF                MOV     R7,A
0154 EF                MOV     A,R7
0155 2408              ADD     A,#08H
0157 FF                MOV     R7,A
0158 EE                MOV     A,R6
0159 3400              ADDC    A,#00H
015B FE                MOV     R6,A
015C 900000      R     MOV     DPTR,#udppkt
015F 120000      E     LCALL   ?C?PLDXDATA
0162 E9                MOV     A,R1
0163 2426              ADD     A,#026H
0165 F9                MOV     R1,A
0166 EA                MOV     A,R2
0167 3400              ADDC    A,#00H
0169 FA                MOV     R2,A
016A EE                MOV     A,R6
016B 8FF0              MOV     B,R7
016D 120000      E     LCALL   ?C?ISTPTR
                                           ; SOURCE LINE # 51
0170 900000      R     MOV     DPTR,#payloadlen
0173 E0                MOVX    A,@DPTR
0174 FE                MOV     R6,A
0175 A3                INC     DPTR
0176 E0                MOVX    A,@DPTR
0177 FF                MOV     R7,A
0178 EF                MOV     A,R7
0179 241C              ADD     A,#01CH
017B FF                MOV     R7,A
017C EE                MOV     A,R6
017D 3400              ADDC    A,#00H
017F FE                MOV     R6,A
0180 900000      R     MOV     DPTR,#udppkt
0183 120000      E     LCALL   ?C?PLDXDATA
0186 E9                MOV     A,R1
0187 2410              ADD     A,#010H
0189 F9                MOV     R1,A
018A EA                MOV     A,R2
018B 3400              ADDC    A,#00H
018D FA                MOV     R2,A
018E EE                MOV     A,R6
018F 8FF0              MOV     B,R7
0191 120000      E     LCALL   ?C?ISTPTR
                                           ; SOURCE LINE # 54
0194 900000      R     MOV     DPTR,#udppkt
0197 120000      E     LCALL   ?C?PLDXDATA
019A E9                MOV     A,R1
019B 2426              ADD     A,#026H
019D F9                MOV     R1,A
019E EA                MOV     A,R2
019F 3400              ADDC    A,#00H
01A1 FA                MOV     R2,A
01A2 120000      E     LCALL   ?C?ILDPTR
C51 COMPILER V9.03   UDP                                                                   07/02/2012 19:47:00 PAGE 8   

01A5 FF                MOV     R7,A
01A6 AEF0              MOV     R6,B
01A8 EF                MOV     A,R7
01A9 24F8              ADD     A,#0F8H
01AB FF                MOV     R7,A
01AC EE                MOV     A,R6
01AD 34FF              ADDC    A,#0FFH
01AF FE                MOV     R6,A
01B0 7D00              MOV     R5,#00H
01B2 900000      R     MOV     DPTR,#udppkt
01B5 120000      E     LCALL   ?C?PLDXDATA
01B8 E9                MOV     A,R1
01B9 242A              ADD     A,#02AH
01BB F9                MOV     R1,A
01BC EA                MOV     A,R2
01BD 3400              ADDC    A,#00H
01BF FA                MOV     R2,A
01C0 120000      E     LCALL   ?C?MEMSET
                                           ; SOURCE LINE # 57
01C3 900000      R     MOV     DPTR,#payloadlen
01C6 E0                MOVX    A,@DPTR
01C7 FE                MOV     R6,A
01C8 A3                INC     DPTR
01C9 E0                MOVX    A,@DPTR
01CA FF                MOV     R7,A
01CB 900000      R     MOV     DPTR,#datapayload
01CE 120000      E     LCALL   ?C?PLDXDATA
01D1 C003              PUSH    AR3
01D3 C002              PUSH    AR2
01D5 C001              PUSH    AR1
01D7 900000      R     MOV     DPTR,#udppkt
01DA 120000      E     LCALL   ?C?PLDXDATA
01DD E9                MOV     A,R1
01DE 242A              ADD     A,#02AH
01E0 F9                MOV     R1,A
01E1 EA                MOV     A,R2
01E2 3400              ADDC    A,#00H
01E4 FA                MOV     R2,A
01E5 A801              MOV     R0,AR1
01E7 AC02              MOV     R4,AR2
01E9 AD03              MOV     R5,AR3
01EB D001              POP     AR1
01ED D002              POP     AR2
01EF D003              POP     AR3
01F1 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 60
01F4 900000      R     MOV     DPTR,#udppkt
01F7 120000      E     LCALL   ?C?PLDXDATA
01FA E9                MOV     A,R1
01FB 240E              ADD     A,#0EH
01FD F9                MOV     R1,A
01FE EA                MOV     A,R2
01FF 3400              ADDC    A,#00H
0201 FA                MOV     R2,A
0202 900000      E     MOV     DPTR,#?_checksum?BYTE+05H
0205 E4                CLR     A
0206 F0                MOVX    @DPTR,A
0207 7D14              MOV     R5,#014H
0209 7C00              MOV     R4,#00H
020B 120000      E     LCALL   _checksum
020E 900000      R     MOV     DPTR,#udppkt
0211 120000      E     LCALL   ?C?PLDXDATA
C51 COMPILER V9.03   UDP                                                                   07/02/2012 19:47:00 PAGE 9   

0214 E9                MOV     A,R1
0215 2418              ADD     A,#018H
0217 F9                MOV     R1,A
0218 EA                MOV     A,R2
0219 3400              ADDC    A,#00H
021B FA                MOV     R2,A
021C EE                MOV     A,R6
021D 8FF0              MOV     B,R7
021F 120000      E     LCALL   ?C?ISTPTR
                                           ; SOURCE LINE # 61
0222 900000      R     MOV     DPTR,#udppkt
0225 120000      E     LCALL   ?C?PLDXDATA
0228 E9                MOV     A,R1
0229 241A              ADD     A,#01AH
022B F9                MOV     R1,A
022C EA                MOV     A,R2
022D 3400              ADDC    A,#00H
022F FA                MOV     R2,A
0230 900000      R     MOV     DPTR,#payloadlen
0233 E0                MOVX    A,@DPTR
0234 FE                MOV     R6,A
0235 A3                INC     DPTR
0236 E0                MOVX    A,@DPTR
0237 FF                MOV     R7,A
0238 EF                MOV     A,R7
0239 2410              ADD     A,#010H
023B FD                MOV     R5,A
023C EE                MOV     A,R6
023D 3400              ADDC    A,#00H
023F FC                MOV     R4,A
0240 900000      E     MOV     DPTR,#?_checksum?BYTE+05H
0243 7401              MOV     A,#01H
0245 F0                MOVX    @DPTR,A
0246 120000      E     LCALL   _checksum
0249 900000      R     MOV     DPTR,#udppkt
024C 120000      E     LCALL   ?C?PLDXDATA
024F E9                MOV     A,R1
0250 2428              ADD     A,#028H
0252 F9                MOV     R1,A
0253 EA                MOV     A,R2
0254 3400              ADDC    A,#00H
0256 FA                MOV     R2,A
0257 EE                MOV     A,R6
0258 8FF0              MOV     B,R7
025A 120000      E     LCALL   ?C?ISTPTR
                                           ; SOURCE LINE # 64
025D 900000      R     MOV     DPTR,#udppkt
0260 120000      E     LCALL   ?C?PLDXDATA
0263 900000      R     MOV     DPTR,#payloadlen
0266 E0                MOVX    A,@DPTR
0267 FE                MOV     R6,A
0268 A3                INC     DPTR
0269 E0                MOVX    A,@DPTR
026A FF                MOV     R7,A
026B EF                MOV     A,R7
026C 242A              ADD     A,#02AH
026E FD                MOV     R5,A
026F EE                MOV     A,R6
0270 3400              ADDC    A,#00H
0272 FC                MOV     R4,A
0273 120000      E     LCALL   _MACWrite
0276 7E00              MOV     R6,#00H
C51 COMPILER V9.03   UDP                                                                   07/02/2012 19:47:00 PAGE 10  

                                           ; SOURCE LINE # 65
0278         ?C0001:
0278 22                RET     
             ; FUNCTION _UDPReply (END)

             ; FUNCTION _UDPSend (BEGIN)
                                           ; SOURCE LINE # 85
0000 900000      R     MOV     DPTR,#targetIP
0003 120000      E     LCALL   ?C?PSTXDATA
0006 900000      R     MOV     DPTR,#targetPort
0009 EC                MOV     A,R4
000A F0                MOVX    @DPTR,A
000B A3                INC     DPTR
000C ED                MOV     A,R5
000D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 89
000E 7B01              MOV     R3,#01H
0010 7A00        R     MOV     R2,#HIGH udppkt
0012 7900        R     MOV     R1,#LOW udppkt
0014 C003              PUSH    AR3
0016 C002              PUSH    AR2
0018 C001              PUSH    AR1
001A 900000      R     MOV     DPTR,#targetIP
001D 120000      E     LCALL   ?C?PLDXDATA
0020 900000      E     MOV     DPTR,#?_SetupBasicIPPacket?BYTE+04H
0023 120000      E     LCALL   ?C?PSTXDATA
0026 D001              POP     AR1
0028 D002              POP     AR2
002A D003              POP     AR3
002C 7D11              MOV     R5,#011H
002E 120000      E     LCALL   _SetupBasicIPPacket
                                           ; SOURCE LINE # 90
0031 900000      R     MOV     DPTR,#udppkt+014H
0034 E0                MOVX    A,@DPTR
0035 FE                MOV     R6,A
0036 A3                INC     DPTR
0037 E0                MOVX    A,@DPTR
0038 FF                MOV     R7,A
0039 EF                MOV     A,R7
003A 541F              ANL     A,#01FH
003C FF                MOV     R7,A
003D 900000      R     MOV     DPTR,#udppkt+014H
0040 EE                MOV     A,R6
0041 F0                MOVX    @DPTR,A
0042 A3                INC     DPTR
0043 EF                MOV     A,R7
0044 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 93
0045 900000      E     MOV     DPTR,#UDPPort
0048 E0                MOVX    A,@DPTR
0049 FE                MOV     R6,A
004A A3                INC     DPTR
004B E0                MOVX    A,@DPTR
004C FF                MOV     R7,A
004D 900000      R     MOV     DPTR,#udppkt+022H
0050 EE                MOV     A,R6
0051 F0                MOVX    @DPTR,A
0052 A3                INC     DPTR
0053 EF                MOV     A,R7
0054 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 94
0055 900000      R     MOV     DPTR,#targetPort
C51 COMPILER V9.03   UDP                                                                   07/02/2012 19:47:00 PAGE 11  

0058 E0                MOVX    A,@DPTR
0059 FE                MOV     R6,A
005A A3                INC     DPTR
005B E0                MOVX    A,@DPTR
005C FF                MOV     R7,A
005D 900000      R     MOV     DPTR,#udppkt+024H
0060 EE                MOV     A,R6
0061 F0                MOVX    @DPTR,A
0062 A3                INC     DPTR
0063 EF                MOV     A,R7
0064 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 97
0065 900000      R     MOV     DPTR,#udppkt+028H
0068 E4                CLR     A
0069 F0                MOVX    @DPTR,A
006A A3                INC     DPTR
006B E4                CLR     A
006C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 98
006D 900000      R     MOV     DPTR,#udppkt+018H
0070 E4                CLR     A
0071 F0                MOVX    @DPTR,A
0072 A3                INC     DPTR
0073 E4                CLR     A
0074 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 101
0075 900000      R     MOV     DPTR,#payloadlen
0078 E0                MOVX    A,@DPTR
0079 FE                MOV     R6,A
007A A3                INC     DPTR
007B E0                MOVX    A,@DPTR
007C FF                MOV     R7,A
007D EF                MOV     A,R7
007E 2408              ADD     A,#08H
0080 FF                MOV     R7,A
0081 EE                MOV     A,R6
0082 3400              ADDC    A,#00H
0084 FE                MOV     R6,A
0085 900000      R     MOV     DPTR,#udppkt+026H
0088 EE                MOV     A,R6
0089 F0                MOVX    @DPTR,A
008A A3                INC     DPTR
008B EF                MOV     A,R7
008C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 102
008D 900000      R     MOV     DPTR,#payloadlen
0090 E0                MOVX    A,@DPTR
0091 FE                MOV     R6,A
0092 A3                INC     DPTR
0093 E0                MOVX    A,@DPTR
0094 FF                MOV     R7,A
0095 EF                MOV     A,R7
0096 241C              ADD     A,#01CH
0098 FF                MOV     R7,A
0099 EE                MOV     A,R6
009A 3400              ADDC    A,#00H
009C FE                MOV     R6,A
009D 900000      R     MOV     DPTR,#udppkt+010H
00A0 EE                MOV     A,R6
00A1 F0                MOVX    @DPTR,A
00A2 A3                INC     DPTR
00A3 EF                MOV     A,R7
C51 COMPILER V9.03   UDP                                                                   07/02/2012 19:47:00 PAGE 12  

00A4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 105
00A5 900000      R     MOV     DPTR,#payloadlen
00A8 E0                MOVX    A,@DPTR
00A9 FE                MOV     R6,A
00AA A3                INC     DPTR
00AB E0                MOVX    A,@DPTR
00AC FF                MOV     R7,A
00AD 900000      R     MOV     DPTR,#datapayload
00B0 120000      E     LCALL   ?C?PLDXDATA
00B3 C003              PUSH    AR3
00B5 C002              PUSH    AR2
00B7 C001              PUSH    AR1
00B9 7B01              MOV     R3,#01H
00BB 7A00        R     MOV     R2,#HIGH udppkt+02AH
00BD 7900        R     MOV     R1,#LOW udppkt+02AH
00BF A801              MOV     R0,AR1
00C1 AC02              MOV     R4,AR2
00C3 AD03              MOV     R5,AR3
00C5 D001              POP     AR1
00C7 D002              POP     AR2
00C9 D003              POP     AR3
00CB 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 108
00CE 7B01              MOV     R3,#01H
00D0 7A00        R     MOV     R2,#HIGH udppkt+0EH
00D2 7900        R     MOV     R1,#LOW udppkt+0EH
00D4 900000      E     MOV     DPTR,#?_checksum?BYTE+05H
00D7 E4                CLR     A
00D8 F0                MOVX    @DPTR,A
00D9 7D14              MOV     R5,#014H
00DB 7C00              MOV     R4,#00H
00DD 120000      E     LCALL   _checksum
00E0 900000      R     MOV     DPTR,#udppkt+018H
00E3 EE                MOV     A,R6
00E4 F0                MOVX    @DPTR,A
00E5 A3                INC     DPTR
00E6 EF                MOV     A,R7
00E7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 109
00E8 7B01              MOV     R3,#01H
00EA 7A00        R     MOV     R2,#HIGH udppkt+01AH
00EC 7900        R     MOV     R1,#LOW udppkt+01AH
00EE 900000      R     MOV     DPTR,#payloadlen
00F1 E0                MOVX    A,@DPTR
00F2 FE                MOV     R6,A
00F3 A3                INC     DPTR
00F4 E0                MOVX    A,@DPTR
00F5 FF                MOV     R7,A
00F6 EF                MOV     A,R7
00F7 2410              ADD     A,#010H
00F9 FD                MOV     R5,A
00FA EE                MOV     A,R6
00FB 3400              ADDC    A,#00H
00FD FC                MOV     R4,A
00FE 900000      E     MOV     DPTR,#?_checksum?BYTE+05H
0101 7401              MOV     A,#01H
0103 F0                MOVX    @DPTR,A
0104 120000      E     LCALL   _checksum
0107 900000      R     MOV     DPTR,#udppkt+028H
010A EE                MOV     A,R6
010B F0                MOVX    @DPTR,A
C51 COMPILER V9.03   UDP                                                                   07/02/2012 19:47:00 PAGE 13  

010C A3                INC     DPTR
010D EF                MOV     A,R7
010E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 112
010F 7B01              MOV     R3,#01H
0111 7A00        R     MOV     R2,#HIGH udppkt
0113 7900        R     MOV     R1,#LOW udppkt
0115 900000      R     MOV     DPTR,#payloadlen
0118 E0                MOVX    A,@DPTR
0119 FE                MOV     R6,A
011A A3                INC     DPTR
011B E0                MOVX    A,@DPTR
011C FF                MOV     R7,A
011D EF                MOV     A,R7
011E 242A              ADD     A,#02AH
0120 FD                MOV     R5,A
0121 EE                MOV     A,R6
0122 3400              ADDC    A,#00H
0124 FC                MOV     R4,A
0125 120000      E     LCALL   _MACWrite
0128 7E00              MOV     R6,#00H
                                           ; SOURCE LINE # 113
012A         ?C0002:
012A 22                RET     
             ; FUNCTION _UDPSend (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    932    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =    362    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
