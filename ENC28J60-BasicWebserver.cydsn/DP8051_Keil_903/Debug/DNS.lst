C51 COMPILER V9.03   DNS                                                                   07/02/2012 19:52:52 PAGE 1   


C51 COMPILER V9.03, COMPILATION OF MODULE DNS
OBJECT MODULE PLACED IN .\DP8051_Keil_903\Debug\DNS.obj
COMPILER INVOKED BY: C:\Program Files (x86)\Cypress\PSoC Creator\2.1\PSoC Creator\import\keil\pk51\9.03\C51\BIN\c51.exe 
                    -.\DNS.c NOIV LARGE MODDP2 OMF2 VB(1) PR(.\DP8051_Keil_903\Debug\DNS.lst) CD DB NOIP OT(0,SIZE) INCDIR(Generated_Source\P
                    -SoC3) OJ(.\DP8051_Keil_903\Debug\DNS.obj)

line level    source

   1          /*
   2           Network Stack for PSoC3-ENC28J60 hardware
   3           -----------------------------------------
   4           Title  : DNS Handling functions
   5           Author : Kartik Mankad
   6           Date : 30-06-12
   7           This code is licensed as CC-BY-SA 3.0
   8           Description : This header file defines the function required for
   9                         carrying out DNS Lookups.
  10          */
  11          
  12          
  13          #include "IPStackMain.h"
  14          
  15          /*******************************************************************************
  16          * Function Name: DNSLookup
  17          ********************************************************************************
  18          * Summary:
  19          *   This function performs a DNSLookup and saves the returned IP Address,
  20          *   (if any) in the variable serverIP defined in "globals.c"
  21          *
  22          * Parameters:
  23          *   url - a constant character string that is the domain name to be
  24          *         looked up. eg: DNSLookup("google.com");
  25          *             
  26          * Returns:
  27          *   TRUE(0)- if the lookup was successful,and serverIP has been updated properly.
  28          *   FALSE(1) - if the lookup was not successful.
  29          *******************************************************************************/
  30          unsigned int DNSLookup( const char* url ){
  31   1          /*Setup variables required*/
  32   1          unsigned char packet[MAXPACKETLEN];
  33   1          unsigned int len,noChars = 0;
  34   1          const char* c;
  35   1          unsigned char* dnsq;
  36   1          unsigned int timeout=3000;
  37   1          
  38   1          /*Structure the variable 'packet' as a DNS header*/
  39   1          DNShdr* dns = (DNShdr*)packet;
  40   1          
  41   1          /*Setup a basic IP packet,of type UDP,since DNS uses UDP
  42   1            as a transport layer*/
  43   1          SetupBasicIPPacket(packet, UDPPROTOCOL, dnsIP);
  44   1          
  45   1          /*Zero out the IP flags*/
  46   1          dns->udp.ip.flags = 0x0;
  47   1          
  48   1          /*----Setup UDP Header----*/
  49   1          dns->udp.sourcePort = (0xABCD);//chosen at random.
  50   1          dns->udp.destPort = (DNSUDPPORT);//Set destination port 53.
  51   1          dns->udp.len = 0;
  52   1          dns->udp.chksum = 0;
  53   1        
C51 COMPILER V9.03   DNS                                                                   07/02/2012 19:52:52 PAGE 2   

  54   1        
  55   1          dns->id = (0xbaab); //chosen at random.
  56   1          dns->flags = (0x0100);
  57   1          dns->qdCount = (1);
  58   1          dns->anCount = 0;
  59   1          dns->nsCount = 0;
  60   1          dns->arCount = 0;
  61   1          
  62   1          /*----Setup the DNS Query----*/
  63   1          /* Format the URL into a proper DNS Query*/
  64   1          dnsq = (char*)(packet + sizeof(DNShdr) + 1);//Note the +1.
  65   1       
  66   1          for( c = url; *c != '\0' && *c !='\\'; ++c, ++dnsq){
  67   2              *dnsq = *c;
  68   2              if ( *c == '.' ){
  69   3                  *(dnsq-(noChars+1)) = noChars;
  70   3                  noChars = 0;
  71   3              }
  72   2              else ++noChars;
  73   2          }
  74   1          
  75   1          *(dnsq-(noChars+1)) = noChars;
  76   1          *dnsq++ = 0;
  77   1          
  78   1          /* Define the host type and class*/
  79   1          *dnsq++ = 0;
  80   1          *dnsq++ = 1;
  81   1          *dnsq++ = 0;
  82   1          *dnsq++ = 1;
  83   1          
  84   1          /*Length of the Packet*/
  85   1          len = (unsigned char*)dnsq-packet;
  86   1          
  87   1          /*Set the IP and UDP length fields*/
  88   1          dns->udp.len = (len-sizeof(IPhdr));
  89   1          dns->udp.ip.len = (len-sizeof(EtherNetII));
  90   1          
  91   1          /*Calculate the UDP and IP Checksums*/
  92   1          dns->udp.ip.chksum=checksum((unsigned char*)dns + sizeof(EtherNetII),sizeof(IPhdr) - sizeof(EtherNetII
             -),0);
  93   1          dns->udp.chksum=checksum((unsigned char*)dns->udp.ip.source,(len+8)-sizeof(IPhdr),1);
  94   1          //(len+8) because Source IP and DestIP,which are part of the pseduoheader,are 4 bytes each.
  95   1          
  96   1          /*Send the DNS Query packet*/
  97   1          MACWrite(packet,len);
  98   1          
  99   1          /*Now that we have sent the query,
 100   1            we wait for the reply,and then process it.*/
 101   1            
 102   1          while(timeout--){
 103   2              /*Wait for a packet of type UDP*/
 104   2              GetPacket(UDPPROTOCOL, packet);
 105   2              /*We got a UDP packet*/
 106   2              /*Check if that packet is sent from port 53,
 107   2                i.e. its a DNS reply. */
 108   2              if( ((UDPhdr*)packet)->sourcePort == (DNSUDPPORT)){
 109   3              /*Yes,its a DNS Reply Packet.*/
 110   3                  dns = (DNShdr*)packet;
 111   3                  /*Check if its our ID,and there are no errors.*/
 112   3                  if ( (dns->id == (0xbaab)) && ((dns->flags && 0x008F)!=0x0080)){
 113   4                  /*Yes,it is error free,and our DNS Reply.Lets extract the IP*/
 114   4                      dnsq=packet+len;
C51 COMPILER V9.03   DNS                                                                   07/02/2012 19:52:52 PAGE 3   

 115   4                      /*Lets go into a loop to browse through the returned resources.*/
 116   4                      for(;;){
 117   5                          if(*dnsq==0xC0){//Is it a pointer?
 118   6                              dnsq+=2;
 119   6                          }else{
 120   6                              /*we just search for the first, zero=root domain
 121   6                              all other octets must be non zero*/
 122   6                              while (++dnsq < packet+len ) {
 123   7                                  if(*dnsq == 0){
 124   8                                      ++dnsq;
 125   8                                      break;
 126   8                                  }       
 127   7                              }       
 128   6                          }
 129   5                          /* There might be multipe records in the answer. 
 130   5                             We are searching for an 'A' record (contains IP Address).*/
 131   5                          if (dnsq[1] == 1 && dnsq[9] == 4) { /*Check if type "A" and IPv4*/
 132   6                              /*Aha! We have our IP!.Lets save it to the global variable serverIP*/
 133   6                              memcpy( serverIP, dnsq+10, sizeof(serverIP));
 134   6                              return(TRUE);
 135   6                              break;
 136   6                          }
 137   5                          /*Advance pointer to browse the remaining records,since we
 138   5                            havent got the right one with an IP*/
 139   5                          dnsq += dnsq[9] + 10;
 140   5                      }//for loop to browse records       
 141   4              
 142   4                      break;
 143   4                  }else{
 144   4                      return(FALSE);
 145   4                  }
 146   3              }
 147   2          }//Outer Packet waiting while loop
 148   1          return(FALSE);
 149   1      }
 150          /* [] END OF FILE */
C51 COMPILER V9.03   DNS                                                                   07/02/2012 19:52:52 PAGE 4   

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION _DNSLookup (BEGIN)
                                           ; SOURCE LINE # 30
0000 900000      R     MOV     DPTR,#url
0003 120000      E     LCALL   ?C?PSTXDATA
                                           ; SOURCE LINE # 33
0006 900000      R     MOV     DPTR,#noChars
0009 E4                CLR     A
000A F0                MOVX    @DPTR,A
000B A3                INC     DPTR
000C E4                CLR     A
000D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 36
000E 900000      R     MOV     DPTR,#timeout
0011 740B              MOV     A,#0BH
0013 F0                MOVX    @DPTR,A
0014 A3                INC     DPTR
0015 74B8              MOV     A,#0B8H
0017 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 39
0018 7B01              MOV     R3,#01H
001A 7A00        R     MOV     R2,#HIGH packet
001C 7900        R     MOV     R1,#LOW packet
001E 900000      R     MOV     DPTR,#dns
0021 120000      E     LCALL   ?C?PSTXDATA
                                           ; SOURCE LINE # 43
0024 7B01              MOV     R3,#01H
0026 7A00        R     MOV     R2,#HIGH packet
0028 7900        R     MOV     R1,#LOW packet
002A C003              PUSH    AR3
002C C002              PUSH    AR2
002E C001              PUSH    AR1
0030 7B01              MOV     R3,#01H
0032 7A00        E     MOV     R2,#HIGH dnsIP
0034 7900        E     MOV     R1,#LOW dnsIP
0036 900000      E     MOV     DPTR,#?_SetupBasicIPPacket?BYTE+04H
0039 120000      E     LCALL   ?C?PSTXDATA
003C D001              POP     AR1
003E D002              POP     AR2
0040 D003              POP     AR3
0042 7D11              MOV     R5,#011H
0044 120000      E     LCALL   _SetupBasicIPPacket
                                           ; SOURCE LINE # 46
0047 900000      R     MOV     DPTR,#dns
004A 120000      E     LCALL   ?C?PLDXDATA
004D E9                MOV     A,R1
004E 2414              ADD     A,#014H
0050 F9                MOV     R1,A
0051 EA                MOV     A,R2
0052 3400              ADDC    A,#00H
0054 FA                MOV     R2,A
0055 120000      E     LCALL   ?C?ILDPTR
0058 FF                MOV     R7,A
0059 AEF0              MOV     R6,B
005B EF                MOV     A,R7
005C 541F              ANL     A,#01FH
005E FF                MOV     R7,A
005F EE                MOV     A,R6
0060 8FF0              MOV     B,R7
0062 120000      E     LCALL   ?C?ISTPTR
C51 COMPILER V9.03   DNS                                                                   07/02/2012 19:52:52 PAGE 5   

                                           ; SOURCE LINE # 49
0065 900000      R     MOV     DPTR,#dns
0068 120000      E     LCALL   ?C?PLDXDATA
006B E9                MOV     A,R1
006C 2422              ADD     A,#022H
006E F9                MOV     R1,A
006F EA                MOV     A,R2
0070 3400              ADDC    A,#00H
0072 FA                MOV     R2,A
0073 74AB              MOV     A,#0ABH
0075 75F0CD            MOV     B,#0CDH
0078 120000      E     LCALL   ?C?ISTPTR
                                           ; SOURCE LINE # 50
007B 900000      R     MOV     DPTR,#dns
007E 120000      E     LCALL   ?C?PLDXDATA
0081 E9                MOV     A,R1
0082 2424              ADD     A,#024H
0084 F9                MOV     R1,A
0085 EA                MOV     A,R2
0086 3400              ADDC    A,#00H
0088 FA                MOV     R2,A
0089 E4                CLR     A
008A 75F035            MOV     B,#035H
008D 120000      E     LCALL   ?C?ISTPTR
                                           ; SOURCE LINE # 51
0090 900000      R     MOV     DPTR,#dns
0093 120000      E     LCALL   ?C?PLDXDATA
0096 E9                MOV     A,R1
0097 2426              ADD     A,#026H
0099 F9                MOV     R1,A
009A EA                MOV     A,R2
009B 3400              ADDC    A,#00H
009D FA                MOV     R2,A
009E E4                CLR     A
009F 75F000            MOV     B,#00H
00A2 120000      E     LCALL   ?C?ISTPTR
                                           ; SOURCE LINE # 52
00A5 900000      R     MOV     DPTR,#dns
00A8 120000      E     LCALL   ?C?PLDXDATA
00AB E9                MOV     A,R1
00AC 2428              ADD     A,#028H
00AE F9                MOV     R1,A
00AF EA                MOV     A,R2
00B0 3400              ADDC    A,#00H
00B2 FA                MOV     R2,A
00B3 E4                CLR     A
00B4 75F000            MOV     B,#00H
00B7 120000      E     LCALL   ?C?ISTPTR
                                           ; SOURCE LINE # 55
00BA 900000      R     MOV     DPTR,#dns
00BD 120000      E     LCALL   ?C?PLDXDATA
00C0 E9                MOV     A,R1
00C1 242A              ADD     A,#02AH
00C3 F9                MOV     R1,A
00C4 EA                MOV     A,R2
00C5 3400              ADDC    A,#00H
00C7 FA                MOV     R2,A
00C8 74BA              MOV     A,#0BAH
00CA 75F0AB            MOV     B,#0ABH
00CD 120000      E     LCALL   ?C?ISTPTR
                                           ; SOURCE LINE # 56
00D0 900000      R     MOV     DPTR,#dns
C51 COMPILER V9.03   DNS                                                                   07/02/2012 19:52:52 PAGE 6   

00D3 120000      E     LCALL   ?C?PLDXDATA
00D6 E9                MOV     A,R1
00D7 242C              ADD     A,#02CH
00D9 F9                MOV     R1,A
00DA EA                MOV     A,R2
00DB 3400              ADDC    A,#00H
00DD FA                MOV     R2,A
00DE 7401              MOV     A,#01H
00E0 75F000            MOV     B,#00H
00E3 120000      E     LCALL   ?C?ISTPTR
                                           ; SOURCE LINE # 57
00E6 900000      R     MOV     DPTR,#dns
00E9 120000      E     LCALL   ?C?PLDXDATA
00EC E9                MOV     A,R1
00ED 242E              ADD     A,#02EH
00EF F9                MOV     R1,A
00F0 EA                MOV     A,R2
00F1 3400              ADDC    A,#00H
00F3 FA                MOV     R2,A
00F4 E4                CLR     A
00F5 75F001            MOV     B,#01H
00F8 120000      E     LCALL   ?C?ISTPTR
                                           ; SOURCE LINE # 58
00FB 900000      R     MOV     DPTR,#dns
00FE 120000      E     LCALL   ?C?PLDXDATA
0101 E9                MOV     A,R1
0102 2430              ADD     A,#030H
0104 F9                MOV     R1,A
0105 EA                MOV     A,R2
0106 3400              ADDC    A,#00H
0108 FA                MOV     R2,A
0109 E4                CLR     A
010A 75F000            MOV     B,#00H
010D 120000      E     LCALL   ?C?ISTPTR
                                           ; SOURCE LINE # 59
0110 900000      R     MOV     DPTR,#dns
0113 120000      E     LCALL   ?C?PLDXDATA
0116 E9                MOV     A,R1
0117 2432              ADD     A,#032H
0119 F9                MOV     R1,A
011A EA                MOV     A,R2
011B 3400              ADDC    A,#00H
011D FA                MOV     R2,A
011E E4                CLR     A
011F 75F000            MOV     B,#00H
0122 120000      E     LCALL   ?C?ISTPTR
                                           ; SOURCE LINE # 60
0125 900000      R     MOV     DPTR,#dns
0128 120000      E     LCALL   ?C?PLDXDATA
012B E9                MOV     A,R1
012C 2434              ADD     A,#034H
012E F9                MOV     R1,A
012F EA                MOV     A,R2
0130 3400              ADDC    A,#00H
0132 FA                MOV     R2,A
0133 E4                CLR     A
0134 75F000            MOV     B,#00H
0137 120000      E     LCALL   ?C?ISTPTR
                                           ; SOURCE LINE # 64
013A 7B01              MOV     R3,#01H
013C 7A00        R     MOV     R2,#HIGH packet+037H
013E 7900        R     MOV     R1,#LOW packet+037H
C51 COMPILER V9.03   DNS                                                                   07/02/2012 19:52:52 PAGE 7   

0140 900000      R     MOV     DPTR,#dnsq
0143 120000      E     LCALL   ?C?PSTXDATA
                                           ; SOURCE LINE # 66
0146 900000      R     MOV     DPTR,#url
0149 120000      E     LCALL   ?C?PLDXDATA
014C 900000      R     MOV     DPTR,#c
014F 120000      E     LCALL   ?C?PSTXDATA
0152         ?C0001:
0152 900000      R     MOV     DPTR,#c
0155 120000      E     LCALL   ?C?PLDXDATA
0158 120000      E     LCALL   ?C?CLDPTR
015B FF                MOV     R7,A
015C EF                MOV     A,R7
015D 7003              JNZ     $ + 5H
015F 020000      R     LJMP    ?C0002
0162 900000      R     MOV     DPTR,#c
0165 120000      E     LCALL   ?C?PLDXDATA
0168 120000      E     LCALL   ?C?CLDPTR
016B FF                MOV     R7,A
016C EF                MOV     A,R7
016D 645C              XRL     A,#05CH
016F 6076              JZ      ?C0002
                                           ; SOURCE LINE # 67
0171 900000      R     MOV     DPTR,#c
0174 120000      E     LCALL   ?C?PLDXDATA
0177 120000      E     LCALL   ?C?CLDPTR
017A FF                MOV     R7,A
017B 900000      R     MOV     DPTR,#dnsq
017E 120000      E     LCALL   ?C?PLDXDATA
0181 EF                MOV     A,R7
0182 120000      E     LCALL   ?C?CSTPTR
                                           ; SOURCE LINE # 68
0185 900000      R     MOV     DPTR,#c
0188 120000      E     LCALL   ?C?PLDXDATA
018B 120000      E     LCALL   ?C?CLDPTR
018E FF                MOV     R7,A
018F EF                MOV     A,R7
0190 B42E33            CJNE    A,#02EH,?C0004
                                           ; SOURCE LINE # 69
0193 900000      R     MOV     DPTR,#noChars
0196 E0                MOVX    A,@DPTR
0197 FE                MOV     R6,A
0198 A3                INC     DPTR
0199 E0                MOVX    A,@DPTR
019A FF                MOV     R7,A
019B 900000      R     MOV     DPTR,#noChars
019E E0                MOVX    A,@DPTR
019F FC                MOV     R4,A
01A0 A3                INC     DPTR
01A1 E0                MOVX    A,@DPTR
01A2 FD                MOV     R5,A
01A3 ED                MOV     A,R5
01A4 2401              ADD     A,#01H
01A6 FD                MOV     R5,A
01A7 EC                MOV     A,R4
01A8 3400              ADDC    A,#00H
01AA FC                MOV     R4,A
01AB 900000      R     MOV     DPTR,#dnsq
01AE 120000      E     LCALL   ?C?PLDXDATA
01B1 C3                CLR     C
01B2 E9                MOV     A,R1
01B3 9D                SUBB    A,R5
C51 COMPILER V9.03   DNS                                                                   07/02/2012 19:52:52 PAGE 8   

01B4 F9                MOV     R1,A
01B5 EA                MOV     A,R2
01B6 9C                SUBB    A,R4
01B7 FA                MOV     R2,A
01B8 EF                MOV     A,R7
01B9 120000      E     LCALL   ?C?CSTPTR
                                           ; SOURCE LINE # 70
01BC 900000      R     MOV     DPTR,#noChars
01BF E4                CLR     A
01C0 F0                MOVX    @DPTR,A
01C1 A3                INC     DPTR
01C2 E4                CLR     A
01C3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 71
01C4 800A              SJMP    ?C0003
01C6         ?C0004:
                                           ; SOURCE LINE # 72
01C6 900000      R     MOV     DPTR,#noChars
01C9 E4                CLR     A
01CA 75F001            MOV     B,#01H
01CD 120000      E     LCALL   ?C?IILDX
01D0         ?C0005:
                                           ; SOURCE LINE # 73
01D0         ?C0003:
01D0 900000      R     MOV     DPTR,#c+01H
01D3 E4                CLR     A
01D4 75F001            MOV     B,#01H
01D7 120000      E     LCALL   ?C?IILDX
01DA 900000      R     MOV     DPTR,#dnsq+01H
01DD E4                CLR     A
01DE 75F001            MOV     B,#01H
01E1 120000      E     LCALL   ?C?IILDX
01E4 020000      R     LJMP    ?C0001
01E7         ?C0002:
                                           ; SOURCE LINE # 75
01E7 900000      R     MOV     DPTR,#noChars
01EA E0                MOVX    A,@DPTR
01EB FE                MOV     R6,A
01EC A3                INC     DPTR
01ED E0                MOVX    A,@DPTR
01EE FF                MOV     R7,A
01EF 900000      R     MOV     DPTR,#noChars
01F2 E0                MOVX    A,@DPTR
01F3 FC                MOV     R4,A
01F4 A3                INC     DPTR
01F5 E0                MOVX    A,@DPTR
01F6 FD                MOV     R5,A
01F7 ED                MOV     A,R5
01F8 2401              ADD     A,#01H
01FA FD                MOV     R5,A
01FB EC                MOV     A,R4
01FC 3400              ADDC    A,#00H
01FE FC                MOV     R4,A
01FF 900000      R     MOV     DPTR,#dnsq
0202 120000      E     LCALL   ?C?PLDXDATA
0205 C3                CLR     C
0206 E9                MOV     A,R1
0207 9D                SUBB    A,R5
0208 F9                MOV     R1,A
0209 EA                MOV     A,R2
020A 9C                SUBB    A,R4
020B FA                MOV     R2,A
C51 COMPILER V9.03   DNS                                                                   07/02/2012 19:52:52 PAGE 9   

020C EF                MOV     A,R7
020D 120000      E     LCALL   ?C?CSTPTR
                                           ; SOURCE LINE # 76
0210 900000      R     MOV     DPTR,#dnsq
0213 E4                CLR     A
0214 75F001            MOV     B,#01H
0217 120000      E     LCALL   ?C?PLDIXDATA
021A E4                CLR     A
021B 120000      E     LCALL   ?C?CSTPTR
                                           ; SOURCE LINE # 79
021E 900000      R     MOV     DPTR,#dnsq
0221 E4                CLR     A
0222 75F001            MOV     B,#01H
0225 120000      E     LCALL   ?C?PLDIXDATA
0228 E4                CLR     A
0229 120000      E     LCALL   ?C?CSTPTR
                                           ; SOURCE LINE # 80
022C 900000      R     MOV     DPTR,#dnsq
022F E4                CLR     A
0230 75F001            MOV     B,#01H
0233 120000      E     LCALL   ?C?PLDIXDATA
0236 7401              MOV     A,#01H
0238 120000      E     LCALL   ?C?CSTPTR
                                           ; SOURCE LINE # 81
023B 900000      R     MOV     DPTR,#dnsq
023E E4                CLR     A
023F 75F001            MOV     B,#01H
0242 120000      E     LCALL   ?C?PLDIXDATA
0245 E4                CLR     A
0246 120000      E     LCALL   ?C?CSTPTR
                                           ; SOURCE LINE # 82
0249 900000      R     MOV     DPTR,#dnsq
024C E4                CLR     A
024D 75F001            MOV     B,#01H
0250 120000      E     LCALL   ?C?PLDIXDATA
0253 7401              MOV     A,#01H
0255 120000      E     LCALL   ?C?CSTPTR
                                           ; SOURCE LINE # 85
0258 900000      R     MOV     DPTR,#dnsq
025B 120000      E     LCALL   ?C?PLDXDATA
025E AE02              MOV     R6,AR2
0260 AF01              MOV     R7,AR1
0262 7B01              MOV     R3,#01H
0264 7A00        R     MOV     R2,#HIGH packet
0266 7900        R     MOV     R1,#LOW packet
0268 AC02              MOV     R4,AR2
026A AD01              MOV     R5,AR1
026C C3                CLR     C
026D EF                MOV     A,R7
026E 9D                SUBB    A,R5
026F FF                MOV     R7,A
0270 EE                MOV     A,R6
0271 9C                SUBB    A,R4
0272 FE                MOV     R6,A
0273 900000      R     MOV     DPTR,#len
0276 EE                MOV     A,R6
0277 F0                MOVX    @DPTR,A
0278 A3                INC     DPTR
0279 EF                MOV     A,R7
027A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 88
027B 900000      R     MOV     DPTR,#len
C51 COMPILER V9.03   DNS                                                                   07/02/2012 19:52:52 PAGE 10  

027E E0                MOVX    A,@DPTR
027F FE                MOV     R6,A
0280 A3                INC     DPTR
0281 E0                MOVX    A,@DPTR
0282 FF                MOV     R7,A
0283 EF                MOV     A,R7
0284 24DE              ADD     A,#0DEH
0286 FF                MOV     R7,A
0287 EE                MOV     A,R6
0288 34FF              ADDC    A,#0FFH
028A FE                MOV     R6,A
028B 900000      R     MOV     DPTR,#dns
028E 120000      E     LCALL   ?C?PLDXDATA
0291 E9                MOV     A,R1
0292 2426              ADD     A,#026H
0294 F9                MOV     R1,A
0295 EA                MOV     A,R2
0296 3400              ADDC    A,#00H
0298 FA                MOV     R2,A
0299 EE                MOV     A,R6
029A 8FF0              MOV     B,R7
029C 120000      E     LCALL   ?C?ISTPTR
                                           ; SOURCE LINE # 89
029F 900000      R     MOV     DPTR,#len
02A2 E0                MOVX    A,@DPTR
02A3 FE                MOV     R6,A
02A4 A3                INC     DPTR
02A5 E0                MOVX    A,@DPTR
02A6 FF                MOV     R7,A
02A7 EF                MOV     A,R7
02A8 24F2              ADD     A,#0F2H
02AA FF                MOV     R7,A
02AB EE                MOV     A,R6
02AC 34FF              ADDC    A,#0FFH
02AE FE                MOV     R6,A
02AF 900000      R     MOV     DPTR,#dns
02B2 120000      E     LCALL   ?C?PLDXDATA
02B5 E9                MOV     A,R1
02B6 2410              ADD     A,#010H
02B8 F9                MOV     R1,A
02B9 EA                MOV     A,R2
02BA 3400              ADDC    A,#00H
02BC FA                MOV     R2,A
02BD EE                MOV     A,R6
02BE 8FF0              MOV     B,R7
02C0 120000      E     LCALL   ?C?ISTPTR
                                           ; SOURCE LINE # 92
02C3 900000      R     MOV     DPTR,#dns
02C6 120000      E     LCALL   ?C?PLDXDATA
02C9 E9                MOV     A,R1
02CA 240E              ADD     A,#0EH
02CC F9                MOV     R1,A
02CD EA                MOV     A,R2
02CE 3400              ADDC    A,#00H
02D0 FA                MOV     R2,A
02D1 900000      E     MOV     DPTR,#?_checksum?BYTE+05H
02D4 E4                CLR     A
02D5 F0                MOVX    @DPTR,A
02D6 7D14              MOV     R5,#014H
02D8 7C00              MOV     R4,#00H
02DA 120000      E     LCALL   _checksum
02DD 900000      R     MOV     DPTR,#dns
C51 COMPILER V9.03   DNS                                                                   07/02/2012 19:52:52 PAGE 11  

02E0 120000      E     LCALL   ?C?PLDXDATA
02E3 E9                MOV     A,R1
02E4 2418              ADD     A,#018H
02E6 F9                MOV     R1,A
02E7 EA                MOV     A,R2
02E8 3400              ADDC    A,#00H
02EA FA                MOV     R2,A
02EB EE                MOV     A,R6
02EC 8FF0              MOV     B,R7
02EE 120000      E     LCALL   ?C?ISTPTR
                                           ; SOURCE LINE # 93
02F1 900000      R     MOV     DPTR,#dns
02F4 120000      E     LCALL   ?C?PLDXDATA
02F7 E9                MOV     A,R1
02F8 241A              ADD     A,#01AH
02FA F9                MOV     R1,A
02FB EA                MOV     A,R2
02FC 3400              ADDC    A,#00H
02FE FA                MOV     R2,A
02FF 900000      R     MOV     DPTR,#len
0302 E0                MOVX    A,@DPTR
0303 FE                MOV     R6,A
0304 A3                INC     DPTR
0305 E0                MOVX    A,@DPTR
0306 FF                MOV     R7,A
0307 EF                MOV     A,R7
0308 24E6              ADD     A,#0E6H
030A FD                MOV     R5,A
030B EE                MOV     A,R6
030C 34FF              ADDC    A,#0FFH
030E FC                MOV     R4,A
030F 900000      E     MOV     DPTR,#?_checksum?BYTE+05H
0312 7401              MOV     A,#01H
0314 F0                MOVX    @DPTR,A
0315 120000      E     LCALL   _checksum
0318 900000      R     MOV     DPTR,#dns
031B 120000      E     LCALL   ?C?PLDXDATA
031E E9                MOV     A,R1
031F 2428              ADD     A,#028H
0321 F9                MOV     R1,A
0322 EA                MOV     A,R2
0323 3400              ADDC    A,#00H
0325 FA                MOV     R2,A
0326 EE                MOV     A,R6
0327 8FF0              MOV     B,R7
0329 120000      E     LCALL   ?C?ISTPTR
                                           ; SOURCE LINE # 97
032C 7B01              MOV     R3,#01H
032E 7A00        R     MOV     R2,#HIGH packet
0330 7900        R     MOV     R1,#LOW packet
0332 900000      R     MOV     DPTR,#len
0335 E0                MOVX    A,@DPTR
0336 FC                MOV     R4,A
0337 A3                INC     DPTR
0338 E0                MOVX    A,@DPTR
0339 FD                MOV     R5,A
033A 120000      E     LCALL   _MACWrite
033D         ?C0006:
                                           ; SOURCE LINE # 102
033D 900000      R     MOV     DPTR,#timeout
0340 74FF              MOV     A,#0FFH
0342 75F0FF            MOV     B,#0FFH
C51 COMPILER V9.03   DNS                                                                   07/02/2012 19:52:52 PAGE 12  

0345 120000      E     LCALL   ?C?ILDIX
0348 AFF0              MOV     R7,B
034A FE                MOV     R6,A
034B EF                MOV     A,R7
034C 4E                ORL     A,R6
034D 7003              JNZ     $ + 5H
034F 020000      R     LJMP    ?C0007
                                           ; SOURCE LINE # 104
0352 7B01              MOV     R3,#01H
0354 7A00        R     MOV     R2,#HIGH packet
0356 7900        R     MOV     R1,#LOW packet
0358 7F11              MOV     R7,#011H
035A 7E00              MOV     R6,#00H
035C 120000      E     LCALL   _GetPacket
                                           ; SOURCE LINE # 108
035F 900000      R     MOV     DPTR,#packet+022H
0362 E0                MOVX    A,@DPTR
0363 FE                MOV     R6,A
0364 A3                INC     DPTR
0365 E0                MOVX    A,@DPTR
0366 FF                MOV     R7,A
0367 EF                MOV     A,R7
0368 6435              XRL     A,#035H
036A 4E                ORL     A,R6
036B 70D0              JNZ     ?C0006
                                           ; SOURCE LINE # 110
036D 7B01              MOV     R3,#01H
036F 7A00        R     MOV     R2,#HIGH packet
0371 7900        R     MOV     R1,#LOW packet
0373 900000      R     MOV     DPTR,#dns
0376 120000      E     LCALL   ?C?PSTXDATA
                                           ; SOURCE LINE # 112
0379 900000      R     MOV     DPTR,#dns
037C 120000      E     LCALL   ?C?PLDXDATA
037F E9                MOV     A,R1
0380 242A              ADD     A,#02AH
0382 F9                MOV     R1,A
0383 EA                MOV     A,R2
0384 3400              ADDC    A,#00H
0386 FA                MOV     R2,A
0387 120000      E     LCALL   ?C?ILDPTR
038A FF                MOV     R7,A
038B AEF0              MOV     R6,B
038D EF                MOV     A,R7
038E 64AB              XRL     A,#0ABH
0390 7003              JNZ     ?C0022
0392 EE                MOV     A,R6
0393 64BA              XRL     A,#0BAH
0395         ?C0022:
0395 6003              JZ      $ + 5H
0397 020000      R     LJMP    ?C0009
039A 900000      R     MOV     DPTR,#dns
039D 120000      E     LCALL   ?C?PLDXDATA
03A0 E9                MOV     A,R1
03A1 242C              ADD     A,#02CH
03A3 F9                MOV     R1,A
03A4 EA                MOV     A,R2
03A5 3400              ADDC    A,#00H
03A7 FA                MOV     R2,A
03A8 120000      E     LCALL   ?C?ILDPTR
03AB FF                MOV     R7,A
03AC AEF0              MOV     R6,B
C51 COMPILER V9.03   DNS                                                                   07/02/2012 19:52:52 PAGE 13  

03AE EF                MOV     A,R7
03AF 4E                ORL     A,R6
03B0 6006              JZ      ?C0010
03B2 7E00              MOV     R6,#00H
03B4 7F01              MOV     R7,#01H
03B6 8004              SJMP    ?C0011
03B8         ?C0010:
03B8 7E00              MOV     R6,#00H
03BA 7F00              MOV     R7,#00H
03BC         ?C0011:
03BC EF                MOV     A,R7
03BD 6480              XRL     A,#080H
03BF 4E                ORL     A,R6
03C0 7003              JNZ     $ + 5H
03C2 020000      R     LJMP    ?C0009
                                           ; SOURCE LINE # 114
03C5 900000      R     MOV     DPTR,#len
03C8 E0                MOVX    A,@DPTR
03C9 FE                MOV     R6,A
03CA A3                INC     DPTR
03CB E0                MOVX    A,@DPTR
03CC FF                MOV     R7,A
03CD 7400        R     MOV     A,#LOW packet
03CF 2F                ADD     A,R7
03D0 F9                MOV     R1,A
03D1 7400        R     MOV     A,#HIGH packet
03D3 3E                ADDC    A,R6
03D4 FA                MOV     R2,A
03D5 7B01              MOV     R3,#01H
03D7 900000      R     MOV     DPTR,#dnsq
03DA 120000      E     LCALL   ?C?PSTXDATA
                                           ; SOURCE LINE # 116
03DD         ?C0012:
                                           ; SOURCE LINE # 117
03DD 900000      R     MOV     DPTR,#dnsq
03E0 120000      E     LCALL   ?C?PLDXDATA
03E3 120000      E     LCALL   ?C?CLDPTR
03E6 FF                MOV     R7,A
03E7 EF                MOV     A,R7
03E8 B4C00C            CJNE    A,#0C0H,?C0016
                                           ; SOURCE LINE # 118
03EB 900000      R     MOV     DPTR,#dnsq+01H
03EE E4                CLR     A
03EF 75F002            MOV     B,#02H
03F2 120000      E     LCALL   ?C?IILDX
                                           ; SOURCE LINE # 119
03F5 804C              SJMP    ?C0015
03F7         ?C0014:
03F7         ?C0016:
                                           ; SOURCE LINE # 122
03F7 900000      R     MOV     DPTR,#len
03FA E0                MOVX    A,@DPTR
03FB FE                MOV     R6,A
03FC A3                INC     DPTR
03FD E0                MOVX    A,@DPTR
03FE FF                MOV     R7,A
03FF 7400        R     MOV     A,#LOW packet
0401 2F                ADD     A,R7
0402 F9                MOV     R1,A
0403 7400        R     MOV     A,#HIGH packet
0405 3E                ADDC    A,R6
0406 FA                MOV     R2,A
C51 COMPILER V9.03   DNS                                                                   07/02/2012 19:52:52 PAGE 14  

0407 7B01              MOV     R3,#01H
0409 C003              PUSH    AR3
040B C002              PUSH    AR2
040D C001              PUSH    AR1
040F 900000      R     MOV     DPTR,#dnsq
0412 E4                CLR     A
0413 75F001            MOV     B,#01H
0416 120000      E     LCALL   ?C?PILDXDATA
0419 C3                CLR     C
041A D082              POP     DPL
041C D083              POP     DPH
041E D0E0              POP     ACC
0420 E9                MOV     A,R1
0421 9582              SUBB    A,DPL
0423 EA                MOV     A,R2
0424 9583              SUBB    A,DPH
0426         ?C0023:
0426 501B              JNC     ?C0015
                                           ; SOURCE LINE # 123
0428 900000      R     MOV     DPTR,#dnsq
042B 120000      E     LCALL   ?C?PLDXDATA
042E 120000      E     LCALL   ?C?CLDPTR
0431 FF                MOV     R7,A
0432 EF                MOV     A,R7
0433 70C2              JNZ     ?C0016
                                           ; SOURCE LINE # 124
0435 900000      R     MOV     DPTR,#dnsq+01H
0438 E4                CLR     A
0439 75F001            MOV     B,#01H
043C 120000      E     LCALL   ?C?IILDX
                                           ; SOURCE LINE # 125
043F 8002              SJMP    ?C0015
                                           ; SOURCE LINE # 126
0441         ?C0018:
                                           ; SOURCE LINE # 127
0441 80B4              SJMP    ?C0016
0443         ?C0017:
                                           ; SOURCE LINE # 128
0443         ?C0015:
                                           ; SOURCE LINE # 131
0443 900000      R     MOV     DPTR,#dnsq
0446 120000      E     LCALL   ?C?PLDXDATA
0449 E9                MOV     A,R1
044A 2401              ADD     A,#01H
044C F9                MOV     R1,A
044D EA                MOV     A,R2
044E 3400              ADDC    A,#00H
0450 FA                MOV     R2,A
0451 120000      E     LCALL   ?C?CLDPTR
0454 FF                MOV     R7,A
0455 EF                MOV     A,R7
0456 6401              XRL     A,#01H
0458 704B              JNZ     ?C0019
045A 900000      R     MOV     DPTR,#dnsq
045D 120000      E     LCALL   ?C?PLDXDATA
0460 E9                MOV     A,R1
0461 2409              ADD     A,#09H
0463 F9                MOV     R1,A
0464 EA                MOV     A,R2
0465 3400              ADDC    A,#00H
0467 FA                MOV     R2,A
0468 120000      E     LCALL   ?C?CLDPTR
C51 COMPILER V9.03   DNS                                                                   07/02/2012 19:52:52 PAGE 15  

046B FF                MOV     R7,A
046C EF                MOV     A,R7
046D B40435            CJNE    A,#04H,?C0019
                                           ; SOURCE LINE # 133
0470 900000      R     MOV     DPTR,#dnsq
0473 120000      E     LCALL   ?C?PLDXDATA
0476 E9                MOV     A,R1
0477 240A              ADD     A,#0AH
0479 F9                MOV     R1,A
047A EA                MOV     A,R2
047B 3400              ADDC    A,#00H
047D FA                MOV     R2,A
047E C003              PUSH    AR3
0480 C002              PUSH    AR2
0482 C001              PUSH    AR1
0484 7B01              MOV     R3,#01H
0486 7A00        E     MOV     R2,#HIGH serverIP
0488 7900        E     MOV     R1,#LOW serverIP
048A A801              MOV     R0,AR1
048C AC02              MOV     R4,AR2
048E AD03              MOV     R5,AR3
0490 D001              POP     AR1
0492 D002              POP     AR2
0494 D003              POP     AR3
0496 7E00              MOV     R6,#00H
0498 7F04              MOV     R7,#04H
049A 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 134
049D E4                CLR     A
049E 7E00              MOV     R6,#00H
04A0 7F00              MOV     R7,#00H
04A2 22                RET     
                                           ; SOURCE LINE # 135
04A3 8035              SJMP    ?C0007
                                           ; SOURCE LINE # 136
04A5         ?C0019:
                                           ; SOURCE LINE # 139
04A5 900000      R     MOV     DPTR,#dnsq
04A8 120000      E     LCALL   ?C?PLDXDATA
04AB E9                MOV     A,R1
04AC 2409              ADD     A,#09H
04AE F9                MOV     R1,A
04AF EA                MOV     A,R2
04B0 3400              ADDC    A,#00H
04B2 FA                MOV     R2,A
04B3 120000      E     LCALL   ?C?CLDPTR
04B6 FF                MOV     R7,A
04B7 7E00              MOV     R6,#00H
04B9 EF                MOV     A,R7
04BA 240A              ADD     A,#0AH
04BC FF                MOV     R7,A
04BD EE                MOV     A,R6
04BE 3400              ADDC    A,#00H
04C0 FE                MOV     R6,A
04C1 900000      R     MOV     DPTR,#dnsq+01H
04C4 EE                MOV     A,R6
04C5 8FF0              MOV     B,R7
04C7 120000      E     LCALL   ?C?IILDX
                                           ; SOURCE LINE # 140
04CA 020000      R     LJMP    ?C0012
04CD         ?C0013:
                                           ; SOURCE LINE # 142
C51 COMPILER V9.03   DNS                                                                   07/02/2012 19:52:52 PAGE 16  

04CD 800B              SJMP    ?C0007
                                           ; SOURCE LINE # 143
04CF 020000      R     LJMP    ?C0006
04D2         ?C0009:
                                           ; SOURCE LINE # 144
04D2 7E00              MOV     R6,#00H
04D4 7F01              MOV     R7,#01H
04D6 22                RET     
                                           ; SOURCE LINE # 145
04D7         ?C0021:
                                           ; SOURCE LINE # 146
04D7         ?C0008:
                                           ; SOURCE LINE # 147
04D7 020000      R     LJMP    ?C0006
04DA         ?C0007:
                                           ; SOURCE LINE # 148
04DA 7E00              MOV     R6,#00H
04DC 7F01              MOV     R7,#01H
                                           ; SOURCE LINE # 149
04DE         ?C0020:
04DE 22                RET     
             ; FUNCTION _DNSLookup (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1247    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =    318    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
