C51 COMPILER V9.03   WEBSERVER                                                             07/02/2012 19:47:01 PAGE 1   


C51 COMPILER V9.03, COMPILATION OF MODULE WEBSERVER
OBJECT MODULE PLACED IN .\DP8051_Keil_903\Debug\Webserver.obj
COMPILER INVOKED BY: C:\Program Files (x86)\Cypress\PSoC Creator\2.1\PSoC Creator\import\keil\pk51\9.03\C51\BIN\c51.exe 
                    -.\Webserver.c NOIV LARGE MODDP2 OMF2 VB(1) PR(.\DP8051_Keil_903\Debug\Webserver.lst) CD DB NOIP OT(0,SIZE) INCDIR(Genera
                    -ted_Source\PSoC3) OJ(.\DP8051_Keil_903\Debug\Webserver.obj)

line level    source

   1          /*
   2           Network Stack for PSoC3-ENC28J60 hardware
   3           -----------------------------------------
   4           Title  : Webserver functions.
   5           Author : Kartik Mankad
   6           Date : 30-06-12
   7           This code is licensed as CC-BY-SA 3.0
   8           Description : Webserver functionality that allows the PSoC to serve dynamic text/html webpages.
   9          */
  10          
  11          #include "IPStackMain.h"
  12          #include <string.h>
  13          #include <stdio.h>
  14          
  15          
  16          unsigned int WebServer_ProcessRequest(TCPhdr* TCPPackData){
  17   1          unsigned int datalen;
  18   1          
  19   1          unsigned int temp;/*Variable to store the Die Temperature*/
  20   1          unsigned char templine[40];/*To store the temperature message*/
  21   1          
  22   1          
  23   1          if (strncmp("GET ",(unsigned char*)TCPPackData+sizeof(TCPhdr),4)!=0){
  24   2              // head, post and other methods:
  25   2              //
  26   2              // for possible status codes see:
  27   2              // http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html
  28   2              datalen=AddWebServerData(TCPPackData,0,"HTTP/1.0 200 OK\r\nContent-Type: text/html\r\n\r\n");
  29   2          }
  30   1          
  31   1          
  32   1          /*Get the temperature*/
  33   1          DieTemp_GetTemp((int16*)&temp);
  34   1          
  35   1          /*Format the temperature into a good string*/
  36   1          sprintf(templine,"<h2>PSoC Temperature is %d deg C</h2>",temp);
  37   1          
  38   1          
  39   1          /*Build HomePage*/
  40   1          if (strncmp("/ ",(unsigned char*)TCPPackData+sizeof(TCPhdr)+4,2)==0){
  41   2              datalen=AddWebServerData(TCPPackData,0,"HTTP/1.0 200 OK\r\nContent-Type: text/html\r\n\r\n");
  42   2              datalen=AddWebServerData(TCPPackData,datalen,"<title>ENC28J60-PSoC3</title>");
  43   2              datalen=AddWebServerData(TCPPackData,datalen,"<h1>ENC28J60-PSoC3</h1>");
  44   2              datalen=AddWebServerData(TCPPackData,datalen,"<hr>");
  45   2              datalen=AddWebServerData(TCPPackData,datalen,templine);
  46   2          }
  47   1          
  48   1          
  49   1          /*Deliver the webpage*/
  50   1          return(ReplyTCP_Webserver(TCPPackData,datalen));
  51   1      }
  52          
  53          /*******************************************************************************
C51 COMPILER V9.03   WEBSERVER                                                             07/02/2012 19:47:01 PAGE 2   

  54          * Function Name: AddWebServerData
  55          ********************************************************************************
  56          * Summary:
  57          *   This function is used to append webpage data to the outgoing reply
  58          *   to the GET query.
  59          *   
  60          * Parameters:
  61          *    TCPPkt - pointer to a TCP packet that has the GET Query.
  62          *    pos  - position in the data part where data must be appended.
  63          *    str - the constant string that is to be appened.This is usually the HTML.
  64          * Returns:
  65          *   current position of data in the TCP packet.
  66          *******************************************************************************/
  67          unsigned int AddWebServerData(TCPhdr* TCPPkt,unsigned int pos,const char* str){
  68   1          while(*str){
  69   2              *((unsigned char*)TCPPkt+sizeof(TCPhdr)+pos)=*str;
  70   2              pos++;
  71   2              str++;
  72   2          }
  73   1          return(pos);
  74   1      }
  75          
  76          /*******************************************************************************
  77          * Function Name: ReplyTCP_Webserver
  78          ********************************************************************************
  79          * Summary:
  80          *   This is used to send the webpage generated by AddWebServerData,in response
  81          *   to the GET query.This function ACK's the GET query,and then sends the reply.
  82          *   
  83          * Parameters:
  84          *    TCPPkt - pointer to a TCP packet that has the Webpage.
  85          *    len  - length of this packet.
  86          * Returns:
  87          *   TRUE(0)- if the packet was successfully sent.
  88          *   FALSE(1) - if the packet was not successful in transmission.
  89          *******************************************************************************/
  90          unsigned int ReplyTCP_Webserver(TCPhdr* TCPPkt,unsigned int datlen){
  91   1          
  92   1          /*Send an ACK for the GET query*/
  93   1          ackTcp(TCPPkt,(TCPPkt->ip.len)+14,0);
  94   1          
  95   1          /*Based on that ACK we sent,create the reply to the GET query*/
  96   1          /*Set the flags.*/
  97   1          TCPPkt->ACK=1;
  98   1          TCPPkt->PSH=1;
  99   1          TCPPkt->FIN=1;
 100   1          
 101   1          /*Set the length field*/
 102   1          TCPPkt->ip.len=(sizeof(TCPhdr)+datlen)-sizeof(EtherNetII);
 103   1          
 104   1          /*Zero out and then compute IP checksum*/
 105   1          TCPPkt->ip.chksum=0x00;
 106   1          TCPPkt->ip.chksum=checksum((unsigned char*)TCPPkt + sizeof(EtherNetII),sizeof(IPhdr)-sizeof(EtherNetII
             -),0);
 107   1          
 108   1          /*Zero out and then compute TCP checksum*/
 109   1          TCPPkt->chksum=0x00;
 110   1          TCPPkt->chksum=checksum((unsigned char*)TCPPkt->ip.source,0x08+0x14+datlen,2);
 111   1          
 112   1          /*Send the reply*/
 113   1          return(MACWrite((unsigned char*)TCPPkt,sizeof(TCPhdr)+datlen)); 
 114   1       }
C51 COMPILER V9.03   WEBSERVER                                                             07/02/2012 19:47:01 PAGE 3   

 115          
 116          /* [] END OF FILE */
C51 COMPILER V9.03   WEBSERVER                                                             07/02/2012 19:47:01 PAGE 4   

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION _WebServer_ProcessRequest (BEGIN)
                                           ; SOURCE LINE # 16
0000 900000      R     MOV     DPTR,#TCPPackData
0003 120000      E     LCALL   ?C?PSTXDATA
                                           ; SOURCE LINE # 23
0006 7BFF              MOV     R3,#0FFH
0008 7A00        R     MOV     R2,#HIGH ?SC_0
000A 7900        R     MOV     R1,#LOW ?SC_0
000C C003              PUSH    AR3
000E C002              PUSH    AR2
0010 C001              PUSH    AR1
0012 900000      R     MOV     DPTR,#TCPPackData
0015 120000      E     LCALL   ?C?PLDXDATA
0018 E9                MOV     A,R1
0019 2436              ADD     A,#036H
001B F9                MOV     R1,A
001C EA                MOV     A,R2
001D 3400              ADDC    A,#00H
001F FA                MOV     R2,A
0020 900000      E     MOV     DPTR,#?_strncmp?BYTE+03H
0023 120000      E     LCALL   ?C?PSTXDATA
0026 900000      E     MOV     DPTR,#?_strncmp?BYTE+06H
0029 E4                CLR     A
002A F0                MOVX    @DPTR,A
002B A3                INC     DPTR
002C 7404              MOV     A,#04H
002E F0                MOVX    @DPTR,A
002F D001              POP     AR1
0031 D002              POP     AR2
0033 D003              POP     AR3
0035 120000      E     LCALL   _strncmp
0038 EF                MOV     A,R7
0039 602D              JZ      ?C0001
                                           ; SOURCE LINE # 28
003B 900000      R     MOV     DPTR,#TCPPackData
003E 120000      E     LCALL   ?C?PLDXDATA
0041 C003              PUSH    AR3
0043 C002              PUSH    AR2
0045 C001              PUSH    AR1
0047 7BFF              MOV     R3,#0FFH
0049 7A00        R     MOV     R2,#HIGH ?SC_5
004B 7900        R     MOV     R1,#LOW ?SC_5
004D 900000      R     MOV     DPTR,#?_AddWebServerData?BYTE+05H
0050 120000      E     LCALL   ?C?PSTXDATA
0053 D001              POP     AR1
0055 D002              POP     AR2
0057 D003              POP     AR3
0059 7D00              MOV     R5,#00H
005B 7C00              MOV     R4,#00H
005D 120000      R     LCALL   _AddWebServerData
0060 900000      R     MOV     DPTR,#datalen
0063 EE                MOV     A,R6
0064 F0                MOVX    @DPTR,A
0065 A3                INC     DPTR
0066 EF                MOV     A,R7
0067 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 29
0068         ?C0001:
                                           ; SOURCE LINE # 33
C51 COMPILER V9.03   WEBSERVER                                                             07/02/2012 19:47:01 PAGE 5   

0068 7B01              MOV     R3,#01H
006A 7A00        R     MOV     R2,#HIGH temp
006C 7900        R     MOV     R1,#LOW temp
006E 120000      E     LCALL   _DieTemp_GetTemp
                                           ; SOURCE LINE # 36
0071 7B01              MOV     R3,#01H
0073 7A00        R     MOV     R2,#HIGH templine
0075 7900        R     MOV     R1,#LOW templine
0077 C003              PUSH    AR3
0079 C002              PUSH    AR2
007B C001              PUSH    AR1
007D 7BFF              MOV     R3,#0FFH
007F 7A00        R     MOV     R2,#HIGH ?SC_50
0081 7900        R     MOV     R1,#LOW ?SC_50
0083 900000      E     MOV     DPTR,#?_sprintf?BYTE+03H
0086 120000      E     LCALL   ?C?PSTXDATA
0089 900000      R     MOV     DPTR,#temp
008C E0                MOVX    A,@DPTR
008D FE                MOV     R6,A
008E A3                INC     DPTR
008F E0                MOVX    A,@DPTR
0090 FF                MOV     R7,A
0091 900000      E     MOV     DPTR,#?_sprintf?BYTE+06H
0094 EE                MOV     A,R6
0095 F0                MOVX    @DPTR,A
0096 A3                INC     DPTR
0097 EF                MOV     A,R7
0098 F0                MOVX    @DPTR,A
0099 D001              POP     AR1
009B D002              POP     AR2
009D D003              POP     AR3
009F 120000      E     LCALL   _sprintf
                                           ; SOURCE LINE # 40
00A2 7BFF              MOV     R3,#0FFH
00A4 7A00        R     MOV     R2,#HIGH ?SC_88
00A6 7900        R     MOV     R1,#LOW ?SC_88
00A8 C003              PUSH    AR3
00AA C002              PUSH    AR2
00AC C001              PUSH    AR1
00AE 900000      R     MOV     DPTR,#TCPPackData
00B1 120000      E     LCALL   ?C?PLDXDATA
00B4 E9                MOV     A,R1
00B5 243A              ADD     A,#03AH
00B7 F9                MOV     R1,A
00B8 EA                MOV     A,R2
00B9 3400              ADDC    A,#00H
00BB FA                MOV     R2,A
00BC 900000      E     MOV     DPTR,#?_strncmp?BYTE+03H
00BF 120000      E     LCALL   ?C?PSTXDATA
00C2 900000      E     MOV     DPTR,#?_strncmp?BYTE+06H
00C5 E4                CLR     A
00C6 F0                MOVX    @DPTR,A
00C7 A3                INC     DPTR
00C8 7402              MOV     A,#02H
00CA F0                MOVX    @DPTR,A
00CB D001              POP     AR1
00CD D002              POP     AR2
00CF D003              POP     AR3
00D1 120000      E     LCALL   _strncmp
00D4 EF                MOV     A,R7
00D5 6003              JZ      $ + 5H
00D7 020000      R     LJMP    ?C0002
C51 COMPILER V9.03   WEBSERVER                                                             07/02/2012 19:47:01 PAGE 6   

                                           ; SOURCE LINE # 41
00DA 900000      R     MOV     DPTR,#TCPPackData
00DD 120000      E     LCALL   ?C?PLDXDATA
00E0 C003              PUSH    AR3
00E2 C002              PUSH    AR2
00E4 C001              PUSH    AR1
00E6 7BFF              MOV     R3,#0FFH
00E8 7A00        R     MOV     R2,#HIGH ?SC_5
00EA 7900        R     MOV     R1,#LOW ?SC_5
00EC 900000      R     MOV     DPTR,#?_AddWebServerData?BYTE+05H
00EF 120000      E     LCALL   ?C?PSTXDATA
00F2 D001              POP     AR1
00F4 D002              POP     AR2
00F6 D003              POP     AR3
00F8 7D00              MOV     R5,#00H
00FA 7C00              MOV     R4,#00H
00FC 120000      R     LCALL   _AddWebServerData
00FF 900000      R     MOV     DPTR,#datalen
0102 EE                MOV     A,R6
0103 F0                MOVX    @DPTR,A
0104 A3                INC     DPTR
0105 EF                MOV     A,R7
0106 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 42
0107 900000      R     MOV     DPTR,#TCPPackData
010A 120000      E     LCALL   ?C?PLDXDATA
010D C003              PUSH    AR3
010F C002              PUSH    AR2
0111 C001              PUSH    AR1
0113 900000      R     MOV     DPTR,#datalen
0116 E0                MOVX    A,@DPTR
0117 FC                MOV     R4,A
0118 A3                INC     DPTR
0119 E0                MOVX    A,@DPTR
011A FD                MOV     R5,A
011B 7BFF              MOV     R3,#0FFH
011D 7A00        R     MOV     R2,#HIGH ?SC_91
011F 7900        R     MOV     R1,#LOW ?SC_91
0121 900000      R     MOV     DPTR,#?_AddWebServerData?BYTE+05H
0124 120000      E     LCALL   ?C?PSTXDATA
0127 D001              POP     AR1
0129 D002              POP     AR2
012B D003              POP     AR3
012D 120000      R     LCALL   _AddWebServerData
0130 900000      R     MOV     DPTR,#datalen
0133 EE                MOV     A,R6
0134 F0                MOVX    @DPTR,A
0135 A3                INC     DPTR
0136 EF                MOV     A,R7
0137 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 43
0138 900000      R     MOV     DPTR,#TCPPackData
013B 120000      E     LCALL   ?C?PLDXDATA
013E C003              PUSH    AR3
0140 C002              PUSH    AR2
0142 C001              PUSH    AR1
0144 900000      R     MOV     DPTR,#datalen
0147 E0                MOVX    A,@DPTR
0148 FC                MOV     R4,A
0149 A3                INC     DPTR
014A E0                MOVX    A,@DPTR
014B FD                MOV     R5,A
C51 COMPILER V9.03   WEBSERVER                                                             07/02/2012 19:47:01 PAGE 7   

014C 7BFF              MOV     R3,#0FFH
014E 7A00        R     MOV     R2,#HIGH ?SC_121
0150 7900        R     MOV     R1,#LOW ?SC_121
0152 900000      R     MOV     DPTR,#?_AddWebServerData?BYTE+05H
0155 120000      E     LCALL   ?C?PSTXDATA
0158 D001              POP     AR1
015A D002              POP     AR2
015C D003              POP     AR3
015E 120000      R     LCALL   _AddWebServerData
0161 900000      R     MOV     DPTR,#datalen
0164 EE                MOV     A,R6
0165 F0                MOVX    @DPTR,A
0166 A3                INC     DPTR
0167 EF                MOV     A,R7
0168 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 44
0169 900000      R     MOV     DPTR,#TCPPackData
016C 120000      E     LCALL   ?C?PLDXDATA
016F C003              PUSH    AR3
0171 C002              PUSH    AR2
0173 C001              PUSH    AR1
0175 900000      R     MOV     DPTR,#datalen
0178 E0                MOVX    A,@DPTR
0179 FC                MOV     R4,A
017A A3                INC     DPTR
017B E0                MOVX    A,@DPTR
017C FD                MOV     R5,A
017D 7BFF              MOV     R3,#0FFH
017F 7A00        R     MOV     R2,#HIGH ?SC_145
0181 7900        R     MOV     R1,#LOW ?SC_145
0183 900000      R     MOV     DPTR,#?_AddWebServerData?BYTE+05H
0186 120000      E     LCALL   ?C?PSTXDATA
0189 D001              POP     AR1
018B D002              POP     AR2
018D D003              POP     AR3
018F 120000      R     LCALL   _AddWebServerData
0192 900000      R     MOV     DPTR,#datalen
0195 EE                MOV     A,R6
0196 F0                MOVX    @DPTR,A
0197 A3                INC     DPTR
0198 EF                MOV     A,R7
0199 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 45
019A 900000      R     MOV     DPTR,#TCPPackData
019D 120000      E     LCALL   ?C?PLDXDATA
01A0 C003              PUSH    AR3
01A2 C002              PUSH    AR2
01A4 C001              PUSH    AR1
01A6 900000      R     MOV     DPTR,#datalen
01A9 E0                MOVX    A,@DPTR
01AA FC                MOV     R4,A
01AB A3                INC     DPTR
01AC E0                MOVX    A,@DPTR
01AD FD                MOV     R5,A
01AE 7B01              MOV     R3,#01H
01B0 7A00        R     MOV     R2,#HIGH templine
01B2 7900        R     MOV     R1,#LOW templine
01B4 900000      R     MOV     DPTR,#?_AddWebServerData?BYTE+05H
01B7 120000      E     LCALL   ?C?PSTXDATA
01BA D001              POP     AR1
01BC D002              POP     AR2
01BE D003              POP     AR3
C51 COMPILER V9.03   WEBSERVER                                                             07/02/2012 19:47:01 PAGE 8   

01C0 120000      R     LCALL   _AddWebServerData
01C3 900000      R     MOV     DPTR,#datalen
01C6 EE                MOV     A,R6
01C7 F0                MOVX    @DPTR,A
01C8 A3                INC     DPTR
01C9 EF                MOV     A,R7
01CA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 46
01CB         ?C0002:
                                           ; SOURCE LINE # 50
01CB 900000      R     MOV     DPTR,#TCPPackData
01CE 120000      E     LCALL   ?C?PLDXDATA
01D1 900000      R     MOV     DPTR,#datalen
01D4 E0                MOVX    A,@DPTR
01D5 FC                MOV     R4,A
01D6 A3                INC     DPTR
01D7 E0                MOVX    A,@DPTR
01D8 FD                MOV     R5,A
01D9 120000      R     LCALL   _ReplyTCP_Webserver
                                           ; SOURCE LINE # 51
01DC         ?C0003:
01DC 22                RET     
             ; FUNCTION _WebServer_ProcessRequest (END)

             ; FUNCTION _AddWebServerData (BEGIN)
                                           ; SOURCE LINE # 67
0000 900000      R     MOV     DPTR,#TCPPkt
0003 120000      E     LCALL   ?C?PSTXDATA
0006 900000      R     MOV     DPTR,#pos
0009 EC                MOV     A,R4
000A F0                MOVX    @DPTR,A
000B A3                INC     DPTR
000C ED                MOV     A,R5
000D F0                MOVX    @DPTR,A
000E         ?C0004:
                                           ; SOURCE LINE # 68
000E 900000      R     MOV     DPTR,#str
0011 120000      E     LCALL   ?C?PLDXDATA
0014 120000      E     LCALL   ?C?CLDPTR
0017 FF                MOV     R7,A
0018 EF                MOV     A,R7
0019 6040              JZ      ?C0005
                                           ; SOURCE LINE # 69
001B 900000      R     MOV     DPTR,#str
001E 120000      E     LCALL   ?C?PLDXDATA
0021 120000      E     LCALL   ?C?CLDPTR
0024 FF                MOV     R7,A
0025 900000      R     MOV     DPTR,#TCPPkt
0028 120000      E     LCALL   ?C?PLDXDATA
002B E9                MOV     A,R1
002C 2436              ADD     A,#036H
002E F9                MOV     R1,A
002F EA                MOV     A,R2
0030 3400              ADDC    A,#00H
0032 FA                MOV     R2,A
0033 900000      R     MOV     DPTR,#pos
0036 E0                MOVX    A,@DPTR
0037 FC                MOV     R4,A
0038 A3                INC     DPTR
0039 E0                MOVX    A,@DPTR
003A FD                MOV     R5,A
003B E9                MOV     A,R1
C51 COMPILER V9.03   WEBSERVER                                                             07/02/2012 19:47:01 PAGE 9   

003C 2D                ADD     A,R5
003D F9                MOV     R1,A
003E EA                MOV     A,R2
003F 3C                ADDC    A,R4
0040 FA                MOV     R2,A
0041 EF                MOV     A,R7
0042 120000      E     LCALL   ?C?CSTPTR
                                           ; SOURCE LINE # 70
0045 900000      R     MOV     DPTR,#pos
0048 E4                CLR     A
0049 75F001            MOV     B,#01H
004C 120000      E     LCALL   ?C?IILDX
                                           ; SOURCE LINE # 71
004F 900000      R     MOV     DPTR,#str+01H
0052 E4                CLR     A
0053 75F001            MOV     B,#01H
0056 120000      E     LCALL   ?C?IILDX
                                           ; SOURCE LINE # 72
0059 80B3              SJMP    ?C0004
005B         ?C0005:
                                           ; SOURCE LINE # 73
005B 900000      R     MOV     DPTR,#pos
005E E0                MOVX    A,@DPTR
005F FE                MOV     R6,A
0060 A3                INC     DPTR
0061 E0                MOVX    A,@DPTR
0062 FF                MOV     R7,A
                                           ; SOURCE LINE # 74
0063         ?C0006:
0063 22                RET     
             ; FUNCTION _AddWebServerData (END)

             ; FUNCTION _ReplyTCP_Webserver (BEGIN)
                                           ; SOURCE LINE # 90
0000 900000      R     MOV     DPTR,#TCPPkt
0003 120000      E     LCALL   ?C?PSTXDATA
0006 900000      R     MOV     DPTR,#datlen
0009 EC                MOV     A,R4
000A F0                MOVX    @DPTR,A
000B A3                INC     DPTR
000C ED                MOV     A,R5
000D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 93
000E 900000      R     MOV     DPTR,#TCPPkt
0011 120000      E     LCALL   ?C?PLDXDATA
0014 C003              PUSH    AR3
0016 C002              PUSH    AR2
0018 C001              PUSH    AR1
001A 900000      R     MOV     DPTR,#TCPPkt
001D 120000      E     LCALL   ?C?PLDXDATA
0020 E9                MOV     A,R1
0021 2410              ADD     A,#010H
0023 F9                MOV     R1,A
0024 EA                MOV     A,R2
0025 3400              ADDC    A,#00H
0027 FA                MOV     R2,A
0028 120000      E     LCALL   ?C?ILDPTR
002B FF                MOV     R7,A
002C AEF0              MOV     R6,B
002E EF                MOV     A,R7
002F 240E              ADD     A,#0EH
0031 FD                MOV     R5,A
C51 COMPILER V9.03   WEBSERVER                                                             07/02/2012 19:47:01 PAGE 10  

0032 EE                MOV     A,R6
0033 3400              ADDC    A,#00H
0035 FC                MOV     R4,A
0036 C200        E     CLR     ?_ackTcp?BIT
0038 D001              POP     AR1
003A D002              POP     AR2
003C D003              POP     AR3
003E 120000      E     LCALL   _ackTcp
                                           ; SOURCE LINE # 97
0041 900000      R     MOV     DPTR,#TCPPkt
0044 120000      E     LCALL   ?C?PLDXDATA
0047 E9                MOV     A,R1
0048 242F              ADD     A,#02FH
004A F9                MOV     R1,A
004B EA                MOV     A,R2
004C 3400              ADDC    A,#00H
004E FA                MOV     R2,A
004F 120000      E     LCALL   ?C?CLDPTR
0052 FF                MOV     R7,A
0053 EF                MOV     A,R7
0054 4410              ORL     A,#010H
0056 FF                MOV     R7,A
0057 EF                MOV     A,R7
0058 120000      E     LCALL   ?C?CSTPTR
                                           ; SOURCE LINE # 98
005B 900000      R     MOV     DPTR,#TCPPkt
005E 120000      E     LCALL   ?C?PLDXDATA
0061 E9                MOV     A,R1
0062 242F              ADD     A,#02FH
0064 F9                MOV     R1,A
0065 EA                MOV     A,R2
0066 3400              ADDC    A,#00H
0068 FA                MOV     R2,A
0069 120000      E     LCALL   ?C?CLDPTR
006C FF                MOV     R7,A
006D EF                MOV     A,R7
006E 4408              ORL     A,#08H
0070 FF                MOV     R7,A
0071 EF                MOV     A,R7
0072 120000      E     LCALL   ?C?CSTPTR
                                           ; SOURCE LINE # 99
0075 900000      R     MOV     DPTR,#TCPPkt
0078 120000      E     LCALL   ?C?PLDXDATA
007B E9                MOV     A,R1
007C 242F              ADD     A,#02FH
007E F9                MOV     R1,A
007F EA                MOV     A,R2
0080 3400              ADDC    A,#00H
0082 FA                MOV     R2,A
0083 120000      E     LCALL   ?C?CLDPTR
0086 FF                MOV     R7,A
0087 EF                MOV     A,R7
0088 4401              ORL     A,#01H
008A FF                MOV     R7,A
008B EF                MOV     A,R7
008C 120000      E     LCALL   ?C?CSTPTR
                                           ; SOURCE LINE # 102
008F 900000      R     MOV     DPTR,#datlen
0092 E0                MOVX    A,@DPTR
0093 FE                MOV     R6,A
0094 A3                INC     DPTR
0095 E0                MOVX    A,@DPTR
C51 COMPILER V9.03   WEBSERVER                                                             07/02/2012 19:47:01 PAGE 11  

0096 FF                MOV     R7,A
0097 EF                MOV     A,R7
0098 2428              ADD     A,#028H
009A FF                MOV     R7,A
009B EE                MOV     A,R6
009C 3400              ADDC    A,#00H
009E FE                MOV     R6,A
009F 900000      R     MOV     DPTR,#TCPPkt
00A2 120000      E     LCALL   ?C?PLDXDATA
00A5 E9                MOV     A,R1
00A6 2410              ADD     A,#010H
00A8 F9                MOV     R1,A
00A9 EA                MOV     A,R2
00AA 3400              ADDC    A,#00H
00AC FA                MOV     R2,A
00AD EE                MOV     A,R6
00AE 8FF0              MOV     B,R7
00B0 120000      E     LCALL   ?C?ISTPTR
                                           ; SOURCE LINE # 105
00B3 900000      R     MOV     DPTR,#TCPPkt
00B6 120000      E     LCALL   ?C?PLDXDATA
00B9 E9                MOV     A,R1
00BA 2418              ADD     A,#018H
00BC F9                MOV     R1,A
00BD EA                MOV     A,R2
00BE 3400              ADDC    A,#00H
00C0 FA                MOV     R2,A
00C1 E4                CLR     A
00C2 75F000            MOV     B,#00H
00C5 120000      E     LCALL   ?C?ISTPTR
                                           ; SOURCE LINE # 106
00C8 900000      R     MOV     DPTR,#TCPPkt
00CB 120000      E     LCALL   ?C?PLDXDATA
00CE E9                MOV     A,R1
00CF 240E              ADD     A,#0EH
00D1 F9                MOV     R1,A
00D2 EA                MOV     A,R2
00D3 3400              ADDC    A,#00H
00D5 FA                MOV     R2,A
00D6 900000      E     MOV     DPTR,#?_checksum?BYTE+05H
00D9 E4                CLR     A
00DA F0                MOVX    @DPTR,A
00DB 7D14              MOV     R5,#014H
00DD 7C00              MOV     R4,#00H
00DF 120000      E     LCALL   _checksum
00E2 900000      R     MOV     DPTR,#TCPPkt
00E5 120000      E     LCALL   ?C?PLDXDATA
00E8 E9                MOV     A,R1
00E9 2418              ADD     A,#018H
00EB F9                MOV     R1,A
00EC EA                MOV     A,R2
00ED 3400              ADDC    A,#00H
00EF FA                MOV     R2,A
00F0 EE                MOV     A,R6
00F1 8FF0              MOV     B,R7
00F3 120000      E     LCALL   ?C?ISTPTR
                                           ; SOURCE LINE # 109
00F6 900000      R     MOV     DPTR,#TCPPkt
00F9 120000      E     LCALL   ?C?PLDXDATA
00FC E9                MOV     A,R1
00FD 2432              ADD     A,#032H
00FF F9                MOV     R1,A
C51 COMPILER V9.03   WEBSERVER                                                             07/02/2012 19:47:01 PAGE 12  

0100 EA                MOV     A,R2
0101 3400              ADDC    A,#00H
0103 FA                MOV     R2,A
0104 E4                CLR     A
0105 75F000            MOV     B,#00H
0108 120000      E     LCALL   ?C?ISTPTR
                                           ; SOURCE LINE # 110
010B 900000      R     MOV     DPTR,#TCPPkt
010E 120000      E     LCALL   ?C?PLDXDATA
0111 E9                MOV     A,R1
0112 241A              ADD     A,#01AH
0114 F9                MOV     R1,A
0115 EA                MOV     A,R2
0116 3400              ADDC    A,#00H
0118 FA                MOV     R2,A
0119 900000      R     MOV     DPTR,#datlen
011C E0                MOVX    A,@DPTR
011D FE                MOV     R6,A
011E A3                INC     DPTR
011F E0                MOVX    A,@DPTR
0120 FF                MOV     R7,A
0121 EF                MOV     A,R7
0122 241C              ADD     A,#01CH
0124 FD                MOV     R5,A
0125 EE                MOV     A,R6
0126 3400              ADDC    A,#00H
0128 FC                MOV     R4,A
0129 900000      E     MOV     DPTR,#?_checksum?BYTE+05H
012C 7402              MOV     A,#02H
012E F0                MOVX    @DPTR,A
012F 120000      E     LCALL   _checksum
0132 900000      R     MOV     DPTR,#TCPPkt
0135 120000      E     LCALL   ?C?PLDXDATA
0138 E9                MOV     A,R1
0139 2432              ADD     A,#032H
013B F9                MOV     R1,A
013C EA                MOV     A,R2
013D 3400              ADDC    A,#00H
013F FA                MOV     R2,A
0140 EE                MOV     A,R6
0141 8FF0              MOV     B,R7
0143 120000      E     LCALL   ?C?ISTPTR
                                           ; SOURCE LINE # 113
0146 900000      R     MOV     DPTR,#TCPPkt
0149 120000      E     LCALL   ?C?PLDXDATA
014C 900000      R     MOV     DPTR,#datlen
014F E0                MOVX    A,@DPTR
0150 FE                MOV     R6,A
0151 A3                INC     DPTR
0152 E0                MOVX    A,@DPTR
0153 FF                MOV     R7,A
0154 EF                MOV     A,R7
0155 2436              ADD     A,#036H
0157 FD                MOV     R5,A
0158 EE                MOV     A,R6
0159 3400              ADDC    A,#00H
015B FC                MOV     R4,A
015C 120000      E     LCALL   _MACWrite
015F 7E00              MOV     R6,#00H
                                           ; SOURCE LINE # 114
0161         ?C0007:
0161 22                RET     
C51 COMPILER V9.03   WEBSERVER                                                             07/02/2012 19:47:01 PAGE 13  

             ; FUNCTION _ReplyTCP_Webserver (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    931    ----
   CONSTANT SIZE    =    150    ----
   XDATA SIZE       =     60    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
